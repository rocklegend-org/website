function disableFunctionKeys(a){var b=new Array(112,113,114,115,116,117,118,119,120,121,123);(b.indexOf(a.keyCode)>-1||b.indexOf(a.which)>-1)&&a.preventDefault()}function WebSocketTest(){return"WebSocket"in window?!0:!1}function facebookLogin(){location.href="/auth/facebook"}function lzw_decode(a){for(var b,c={},d=(a+"").split(""),e=d[0],f=e,g=[e],h=256,i=1;i<d.length;i++){var j=d[i].charCodeAt(0);b=256>j?d[i]:c[j]?c[j]:f+e,g.push(b),e=b.charAt(0),c[h]=f+e,h++,f=b}return g.join("")}function lzw_encode(a){for(var b,c={},d=(a+"").split(""),e=[],f=d[0],g=256,h=1;h<d.length;h++)b=d[h],null!=c[f+b]?f+=b:(e.push(f.length>1?c[f]:f.charCodeAt(0)),c[f+b]=g,g++,f=b);e.push(f.length>1?c[f]:f.charCodeAt(0));for(var h=0;h<e.length;h++)e[h]=String.fromCharCode(e[h]);return e.join("")}function base64_encode(a){a=escape(a);var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+keyStr.charAt(d)+keyStr.charAt(e)+keyStr.charAt(f)+keyStr.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g}function base64_decode(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;k.exec(a)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=keyStr.indexOf(a.charAt(j++)),e=keyStr.indexOf(a.charAt(j++)),f=keyStr.indexOf(a.charAt(j++)),i=keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return unescape(g)}function appendTrackComment(a){var b=$('.comments-module[data-track-id="'+a.track_id+'"]');$.post("/track/comments/"+a.track_id,{_token:csrf},function(a){b.replaceWith(a),rl.initializeAjaxForms()})}if(WebSocketTest?window.realtime={}:window.realtime=!1,$(document).ready(function(){$(document).on("keydown",disableFunctionKeys)}),jQuery(function(a){a(document).foundation({abide:{patterns:{password:/^(.){5,}$/}}}),a(".fancybox").fancybox({beforeShow:function(){var a=this.element.find("img").attr("alt");this.inner.find("img").attr("alt",a),this.title=a}}),rl.init(),rl.parallax(),notifications.init()}),"undefined"==typeof currentArtistId)var currentArtistId=0;if("undefined"==typeof currentSongId)var currentSongId=0;var rl={init:function(){$(".tooltip").tooltip({track:!0}),$("div[data-image]").each(function(){$(this).backstretch($(this).attr("data-image"),0)}),$("#home-slider").length>0&&$("#home-slider").bxSlider({pager:!1,mode:"fade",randomStart:!0,auto:!0,pause:2500,autoShow:!0,autoHover:!0}),this.initializeAjaxForms(),$("#mobile-nav-toggle").on("click",rl.toggleMobileNav),$("button.changeKey").on("click",function(a){var b=$(this).data("name"),c=$(this);$(this).html("Please press the key you want to use."),$(document).bind("keyup.changeKey",function(a){$('input[name="'+b+'"]').val(a.which),c.html(String.fromCharCode(a.which)),$(document).unbind("keyup.changeKey")})}),$(".info-box .close").on("click",function(){$(this).parents(".info-box").removeClass("active")})},toggleMobileNav:function(){jQuery("ul.navigation.main li").not(".mobile-nav").each(function(){jQuery(this).hasClass("hide-on-small")?jQuery(this).removeClass("hide-on-small"):jQuery(this).addClass("hide-on-small")})},jumpTo:function(a){jQuery.scrollTo(jQuery(a),1e3)},parallax:function(){jQuery(window).on("scroll",function(){waitForFinalEvent(function(){var a=jQuery(window).scrollTop();jQuery(".trenn").each(function(){var b=jQuery(this).css("backgroundPosition").split(" ");jQuery(this).css({"background-position":b[0]+" "+(a-520)+"px"})})},0,"parallax")})},toggleFocus:function(){"block"==$("#rl-page-darken-overlay").css("display")?rl.darkenPage(!1):rl.darkenPage(!0)},darkenPage:function(a){a?($("#rl-page-darken-overlay").css({height:$(document).height(),width:$(document).width()}),$("#rl-page-darken-overlay").fadeIn(),rl.focusMode=!0):($("#rl-page-darken-overlay").fadeOut(),rl.focusMode=!1)},initializeAjaxForms:function(){$("form.ajax").unbind().ajaxForm({dataType:"json",beforeSubmit:function(arr,$form){var before=$form.data("before");return"undefined"!=typeof before&&""!=before&&eval(before+"()"),!0},success:function(data,status,xhr,$form){var cb=$form.data("cb");"undefined"!=typeof cb&&""!=cb&&eval(cb+"(data)")}})}};rl.badge={showBadgeInfo:function(a){function b(a){var b=$(".info-box--bottom");b.find(".badge-title").html(a.name),b.find(".badge-description").html(a.description),b.find(".badge-info img").attr("src","/assets/images/frontend/badges/"+a.image).attr("alt",a.name),b.addClass("active")}"number"==typeof a?$.post("/badge/"+a+".json",function(a){b(a)},"json"):b(a)}};var pageLoader={_pl:null,time:0,init:function(){this._pl=jQuery("#rl-page-loading-overlay")},loadPage:function(a){pageLoader.show(),setTimeout(function(){location.href=a},pageLoader._time)},submitForm:function(a){var b=jQuery("#"+a).attr("data-invalid");("undefined"==typeof b||b===!1)&&(pageLoader.show(),setTimeout(function(){jQuery("#"+a).addClass("pl-ready").submit()},pageLoader._time))},show:function(){pageLoader._pl.fadeIn(0)},hide:function(){pageLoader._pl.fadeOut(0)}},waitForFinalEvent=function(){var a={};return function(b,c,d){d||(d="Don't call this twice without a uniqueId"),a[d]&&clearTimeout(a[d]),a[d]=setTimeout(b,c)}}(),guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";$(function(){window.chat={$c:$(".realtime-chat-container"),$msg:$(".realtime-chat-container .messages"),user_id:0,unread_messages:0,init:function(){this.user_id=this.$c.find('input[name="user_id"]').val(),window.realtime.chat=realtime_services.chat.socket,realtime.chat.emit("new.user",{user_id:this.user_id}),chat.toggleCloseIcon(),this.$c.find(".handle").on("click",window.chat.toggle),this.$c.find("form.chat-message").on("submit",function(a){a.preventDefault(),""!=$(this).find('input[name="chat-message"]').val()&&(realtime.chat.emit("new.message",{message:$(this).find('input[name="chat-message"]').val(),user_id:$(this).find('input[name="user_id"]').val(),guid:guid()}),$(this).find('input[name="chat-message"]').val(""))}),this.initEventListeners(),this.$msg.animate({scrollTop:this.$msg[0].scrollHeight})},hide:function(){this.$c.remove()},toggle:function(){chat.$c.toggleClass("active"),chat.toggleCloseIcon(),$.post("/chat/set-open",{open:window.chat.$c.hasClass("active")}),window.chat.$c.hasClass("active")&&(chat.$c.find(".unread-container").removeClass("show"),chat.unread_messages=0,chat.$c.find(".unread-container .unread-count").html("0"))},toggleCloseIcon:function(){chat.$c.hasClass("active")?chat.$c.find(".close").fadeIn():chat.$c.find(".close").fadeOut()},appendMessage:function(a){this.$msg.append($(a.html)),this.$msg.stop().animate({scrollTop:this.$msg[0].scrollHeight})},initEventListeners:function(){realtime.chat.on("new.message",function(a){chat.appendMessage(a),0==chat.$c.hasClass("active")&&(chat.unread_messages++,0==chat.$c.find(".unread-container").hasClass("show")&&chat.$c.find(".unread-container").addClass("show"),chat.$c.find(".unread-container .unread-count").html(chat.unread_messages))}),realtime.chat.on("user.count",function(a){chat.$c.find(".user-count").html(a.count)})}},window.realtime&&window.chat.$msg.length>0?window.chat.init():window.chat.hide()}),$(function(){$(document).on("click",'.comments-module input[type="submit"]',function(a){return""!=$(this).parent().find("textarea").val()&&($(this).attr("disabled","disabled"),$(this).css("cursor","wait"),$(this).parents("form").submit()),!1}),$(document).on("focus",".comment-options textarea",function(){"undefined"!=typeof RL&&(RL.typing=!0)}),$(document).on("blur",".comment-options textarea",function(){"undefined"!=typeof RL&&(RL.typing=!1)}),$(document).on("click",".comments-pagination a",function(a){a.preventDefault();var b=$(this).attr("href").replace("#",""),c=$(this).parents(".comments-module"),d=$('textarea[name="comment"]').val();$.post(b,{comment:d,_token:csrf},function(a){c.replaceWith(a),rl.initializeAjaxForms()})}),$(document).on("click","a.comment-reply",function(a){a.preventDefault();var b=$(this).attr("href"),c=($(this).parent().data("track-id"),$('<b>Reply to comment</b><textarea></textarea><a href="#">Send reply</a>'));$(this).parent().append(c),$(this).parent().find('a[href="#"]').on("click",function(a){a.preventDefault();var c=$(this).parent().find("textarea").val();""!=c&&($(this).parent().find('a[href="#"]').remove(),$.post(b,{reply:c,_token:csrf},function(a){appendTrackComment(a)}))}),$(this).remove()})}),window.conversations={messageCount:5,checkInterval:!1,autoScroll:!0,sendOnEnter:!1,init:function(){autoSuggestPrefill="undefined"!=typeof autoSuggestPrefill?autoSuggestPrefill:"",$("input[name=recipients]").autoSuggest("/conversations/availableRecipients",{minChars:2,matchCase:!1,canGenerateNewSelections:!1,neverSubmit:!0,useOriginalInputName:!0,selectionLimit:8,preFill:autoSuggestPrefill}),$("input[name=recipients]").attr("required",!0),$('input[name="useEnterForSend"]').on("change",function(){conversations.sendOnEnter=$('input[name="useEnterForSend"]').is(":checked")}),$('#send-conversation-message textarea[name="message"]').on("keydown",function(a){return conversations.sendOnEnter&&13==a.keyCode&&$(this).val().length>0?($(this.form).submit(),$(this).val(""),!1):void 0}),$(".messages-container").on("scroll",function(){conversations.autoScroll=!1}),$("a.js-load-all-messages").on("click",function(){$(".messages-container").fadeTo(250,.5),$.get("/conversations/messages/"+$(this).parents(".messages-container").eq(0).data("conversation-id"),{limit:0,_token:csrf},conversations.update)}),$(".messages-container").length>0&&(conversations.checkInterval=setInterval(function(){conversations.fetchMessages()},5e3)),conversations.scrollToCurrent()},beforeMessage:function(){conversations.autoScroll=!0,$(".messages-container").fadeTo(250,.5),$('#send-conversation-message textarea[name="message"]').val("")},fetchMessages:function(){conversations.autoScroll=!0,$(".messages-container").each(function(){$.get("/conversations/messages/"+$(this).data("conversation-id"),{ident:$(this).find(".identifier").data("ident"),_token:csrf},conversations.update)})},update:function(a){$(".messages-container").fadeTo(250,1),$("#conversation-"+a.id).html(a.html),conversations.autoScroll&&setTimeout(function(){conversations.scrollToCurrent()},250),profiles.updateProfileInfoTooltips()},scrollToCurrent:function(){$(".messages-container").each(function(){$(this).animate({scrollTop:$(this)[0].scrollHeight},500)})}},window.discover={init:function(){$('input[name="search_text"]').on("keyup",function(a){var b=$(this).val();""!=b?($(".artist-box-big").each(function(){$(this).data("artist").toLowerCase().indexOf(b.toLowerCase())>-1?$(this).removeClass("invisible").addClass("visible").show():$(this).removeClass("visible").addClass("invisible").hide().css("display","none")}),$(".song-title").each(function(){$(this).text().toLowerCase().indexOf(b.toLowerCase())>-1&&$(this).parents(".artist-box-big").removeClass("invisible").addClass("visible").show()})):$(".artist-box-big").each(function(){$(this).removeClass("invisible").addClass("visible").show()}),discover.updateClears()}),$(".js-discover-sort").on("click",function(a){a.preventDefault(),$(".js-discover-sort").addClass("inactive"),$(this).removeClass("inactive");var b=$(this).data("sort");switch(b){case"plays":$(".artist-box-big").tsort({attr:"data-artist-plays",order:"desc"});break;case"name":$(".artist-box-big").tsort({attr:"data-artist"});break;case"artist_added":$(".artist-box-big").tsort({attr:"data-artist-added"})}discover.updateClears()})},updateClears:function(){$(".artist-container .clear").remove(),$(".artist-box-big.visible").each(function(a,b){(a+1)%2==0&&($(this).after('<div class="clear"></div>'),counter=0)})}},window.notifications={hideTimeout:!1,init:function(){$(document).on("mouseover",".notifications-container",function(a){clearTimeout(notifications.hideTimeout),$(".notifications-list").stop().fadeIn()}),$(document).on("mouseleave",".notifications-container",function(a){notifications.hideTimeout=setTimeout(function(){$(".notifications-list").stop().fadeOut()},500)}),$(document).on("click",".notifications-list li.notification",function(a){$(this).hasClass("title")||(a.preventDefault(),$.post("/notifications/dismiss",{id:$(this).data("notification-id"),_token:csrf}),location.href=$(this).find("a").attr("href"))})},update:function(){$.get("/notifications.html?_token="+csrf,function(a){$(".notifications-container").replaceWith(a)})}},window.playerPage={init:function(){$.post("/track/notes.json",{id:track_id,_token:csrf},function(a){aNotes=base64_decode(a.notes),aNotes=JSON.parse(aNotes),aNotes.length<=5&&aNotes.splice(0,0,[!1]),RL.showLoadingScreen(),RL.init()}),$(".js-nscroll").nscroll({parent:".js-nscroll-parent",offsetY:-100,speed:250})}},$(function(){window.profiles={init:function(){$('a[href*="profile/detail"]').not(".no-tooltip").each(function(){var a=$(this).attr("href"),b=a.match(/profile\/detail\/(.*)/i);b=b[1],$(this).data("tipped-options","ajax: { url: '/profile/box/"+b+"' }"),Tipped.create(this,{skin:"light",size:"small"})}),$(document).on("click",".js-follow",function(a){a.preventDefault(),window.profiles.follow($(this).data("user-id"),$(this))}),$(document).on("click",".js-unfollow",function(a){a.preventDefault(),window.profiles.unfollow($(this).data("user-id"),$(this))})},updateProfileInfoTooltips:function(){$('a[href*="profile/detail"]').not(".no-tooltip").each(function(){if("undefined"==typeof $(this).data("tipped-options")){var a=$(this).attr("href"),b=a.match(/profile\/detail\/(.*)/i);b=b[1],$(this).data("tipped-options","ajax: { url: '/profile/box/"+b+"' }"),Tipped.create(this,{skin:"light",size:"small"})}}),$('a[href*="profile/detail"]').not(".no-tooltip").each(function(){Tipped.refresh(this)})},follow:function(a,b){$.post("/profile/follow",{user_id:a,_token:csrf},function(){b.removeClass("js-follow").addClass("js-unfollow"),b.html('<i class="fa fa-eye-slash"></i> Unfollow'),profiles.updateProfileInfoTooltips()})},unfollow:function(a,b){$.post("/profile/unfollow",{user_id:a,_token:csrf},function(){b.removeClass("js-unfollow").addClass("js-follow"),b.html('<i class="fa fa-eye"></i> Follow!'),profiles.updateProfileInfoTooltips()})}},window.profiles.init()}),window.scores={region:"global",timespan:"week",track_id:null,page:0,init:function(a){scores.track_id=a,$('select[name="highscores-timespan"]').on("change",function(a){var b=$('select[name="highscores-timespan"] option:selected').val();scores.timespan=b,scores.fetch()}),$("a.js-scores-region").on("click",function(a){a.preventDefault(),$("a.js-scores-region.active").removeClass("active"),$(this).addClass("active"),scores.region=$(this).data("region"),scores.fetch()})},fetch:function(){$.post("/track/"+scores.track_id+".scores.html",{track_id:scores.track_id,timespan:scores.timespan,region:scores.region,_token:csrf},function(a){$(".highscore-box .highscore-list").html(a),window.profiles.updateProfileInfoTooltips()})}};