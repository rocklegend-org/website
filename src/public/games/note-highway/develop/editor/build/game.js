/*! rocklegend note-highway 09-09-2019 */

function keyDownHandler(a){if(!$("input, textarea").is(":focus")){var b=RL.keyCodeToIndex(a.keyCode),c=a.ctrlKey;RL.editMode&&RL.config.trackTaps?EditorManager.addTap(b,AudioManager.currentTime,c):HighwayManager.startHitDetection(b),5>=b&&(HighwayManager.aButtons[b].frame=5*b-4)}}function keyHoldHandler(a){if(!$("input, textarea").is(":focus")){var b=RL.keyCodeToIndex(a.keyCode),c=a.ctrlKey;RL.editMode&&RL.config.trackTaps?EditorManager.holdTap(b,a.duration,AudioManager.currentTime,c):HighwayManager.continueHitDetection(b,a.duration)}}function keyUpHandler(a){if(!$("input, textarea").is(":focus")){var b=RL.keyCodeToIndex(a.keyCode),c=a.ctrlKey;RL.editMode&&RL.config.trackTaps&&a.duration>=RL.config.longNoteThreshold?EditorManager.finishTap(b,a.duration,AudioManager.currentTime,c):RL.config.trackTaps&&RL.editMode||HighwayManager.endHitDetection(b),5>=b&&(HighwayManager.aButtons[b].frame=5*b-5)}}function numberWithDots(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("Luv",[],b):a.Luv=b()}(this,function(){var a=function(){var a=function(a){for(var b,c=1;arguments.length>c;c++){b=arguments[c];for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},b=function(a,b){b=Array.isArray(b)?b:[b];for(var c=0;b.length>c;c++)delete a[b[c]];return a},c=Object.create,d={toString:function(){return"instance of "+this.getClass().getName()}},e=a(function(){return c(d)},{init:function(){},getName:function(){return"Base"},toString:function(){return"Base"},getSuper:function(){return null},methods:d,include:function(){return a.apply(this,[this.methods].concat(Array.prototype.slice.call(arguments,0)))},subclass:function(d,e){e=e||{};var f=this,g=function(){return d},h=b(a(c(f.methods),e),"init"),i=a(function(){var a=c(h);return i.init.apply(a,arguments),a},f,e,{getName:g,toString:g,getSuper:function(){return f},methods:h});return h.getClass=function(){return i},i}});d.getClass=function(){return e};var f=e.subclass("Luv",{init:function(a){a=g(a);var b=this;if(b.el=a.el,b.el.tabIndex=1,"load update draw run onResize onBlur onFocus".split(" ").forEach(function(c){a[c]&&(b[c]=a[c])}),b.media=f.Media(),b.timer=f.Timer(),b.keyboard=f.Keyboard(b.el),b.mouse=f.Mouse(b.el),b.touch=f.Touch(b.el),b.audio=f.Audio(b.media),b.graphics=f.Graphics(b.el,b.media),b.canvas=f.Graphics.Canvas(b.el),a.fullWindow){var c=function(){b.canvas.setDimensions(window.innerWidth,window.innerHeight),b.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",c,!1),window.addEventListener("orientationChange",c,!1),b.el.focus()}b.el.addEventListener("blur",function(){b.onBlur()}),b.el.addEventListener("focus",function(){b.onFocus()})},load:function(){},draw:function(){},update:function(){},run:function(){var a=this;a.load();var b=function(){a.timer.nativeUpdate(a.el);var c=a.timer.getDeltaTime();a.update(c),a.canvas.clear(),a.draw(),a.timer.nextFrame(b)};a.timer.nextFrame(b)},onResize:function(){},onBlur:function(){},onFocus:function(){}});f.Class=function(a,b){return e.subclass(a,b)},f.Base=e,f.extend=a;var g=function(a){a=a||{};var b=a.el,c=a.id,d=a.width,e=a.height,f=document.getElementsByTagName("body")[0],g=document.getElementsByTagName("html")[0],h="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!b&&c&&(b=document.getElementById(c)),b?(!d&&b.getAttribute("width")&&(d=Number(b.getAttribute("width"))),!e&&b.getAttribute("height")&&(e=Number(b.getAttribute("height")))):(b=document.createElement("canvas"),f.appendChild(b)),a.fullWindow?(g.style.cssText=f.style.cssText=h,d=window.innerWidth,e=window.innerHeight):(d=d||800,e=e||600),b.setAttribute("width",d),b.setAttribute("height",e),a.el=b,a.width=d,a.height=e,a};return f}();return function(){a.Timer=a.Class("Luv.Timer",{init:function(){this.microTime=c.now(),this.deltaTime=0,this.deltaTimeLimit=a.Timer.DEFAULT_DELTA_TIME_LIMIT,this.events={},this.maxEventId=0},nativeUpdate:function(a){this.update((c.now()-this.microTime)/1e3,a)},update:function(a){this.deltaTime=Math.max(0,Math.min(this.deltaTimeLimit,a)),this.microTime+=1e3*a;for(var b in this.events)this.events.hasOwnProperty(b)&&this.events[b].update(a)&&delete this.events[b]},setDeltaTimeLimit:function(a){this.deltaTimeLimit=a},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(a){e(a)},after:function(c,d,e){return b(this,a.Timer.After(c,d,e))},every:function(c,d,e){return b(this,a.Timer.Every(c,d,e))},tween:function(c,d,e,f){return b(this,a.Timer.Tween(c,d,e,f))},clear:function(a){return this.events[a]?(delete this.events[a],!0):!1}}),a.Timer.DEFAULT_DELTA_TIME_LIMIT=.25;var b=function(a,b){var c=a.maxEventId++;return a.events[c]=b,c},c=window.performance||Date;c.now=c.now||c.msNow||c.mozNow||c.webkitNow||Date.now;var d=0,e=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(a){var b=c.now(),e=Math.max(0,16-(b-d)),f=setTimeout(function(){a(b+e)},e);return d=b+e,f}}(),function(){a.Timer.After=a.Class("Luv.Timer.After",{init:function(a,b,c){this.timeRunning=0,this.timeToCall=a,this.callback=b,this.context=c},update:function(a){this.timeRunning+=a;var b=this.timeRunning-this.timeToCall;return b>=0?(this.callback.call(this.context,b),!0):!1}})}(),function(){a.Timer.Every=a.Class("Luv.Timer.Every",{init:function(a,b,c){this.timeRunning=0,this.timeToCall=a,this.callback=b,this.context=c},update:function(a){if(this.timeRunning+=a,this.timeToCall>0)for(;this.timeRunning>=this.timeToCall;)this.callback.call(this.context,this.timeRunning-this.timeToCall),this.timeRunning-=this.timeToCall;else this.callback.call(this.context,a);return!1}})}(),function(){a.Timer.Tween=a.Class("Luv.Timer.Tween",{init:function(a,b,c,d){S(b,c,[]),d=d||{},this.easing=U(d.easing),this.every=d.every||this.every,this.after=d.after||this.after,this.context=d.context||this,this.runningTime=0,this.finished=!1,this.timeToFinish=a,this.subject=b,this.from=W(b,c),this.to=W(c)},update:function(a){return this.runningTime>=this.timeToFinish?void 0:(this.runningTime+=a,this.runningTime>=this.timeToFinish&&(this.runningTime=this.timeToFinish,this.after.call(this.context),this.finished=!0),this.every.call(this.context,T(this,this.from,this.to)),this.finished)},every:function(a){this.subject=V(this.subject,a)},after:function(){},isFinished:function(){return!!this.finished}});var b=function(a,b,c,d){return c*a/d+b},c=function(a,b,c,d){return c*Math.pow(a/d,2)+b},d=function(a,b,c,d){return a/=d,-c*a*(a-2)+b},e=function(a,b,c,d){return a=2*(a/d),1>a?c/2*Math.pow(a,2)+b:-c/2*((a-1)*(a-3)-1)+b},f=function(a,b,e,f){return f/2>a?d(2*a,b,e/2,f):c(2*a-f,b+e/2,e/2,f)},g=function(a,b,c,d){return c*Math.pow(a/d,3)+b},h=function(a,b,c,d){return c*(Math.pow(a/d-1,3)+1)+b},i=function(a,b,c,d){return a=2*(a/d),1>a?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b)},j=function(a,b,c,d){return d/2>a?h(2*a,b,c/2,d):g(2*a-d,b+c/2,c/2,d)},k=function(a,b,c,d){return c*Math.pow(a/d,4)+b},l=function(a,b,c,d){return-c*(Math.pow(a/d-1,4)-1)+b},m=function(a,b,c,d){return a=2*(a/d),1>a?c/2*Math.pow(a,4)+b:-c/2*(Math.pow(a-2,4)-2)+b},n=function(a,b,c,d){return d/2>a?l(2*a,b,c/2,d):k(2*a-d,b+c/2,c/2,d)},o=function(a,b,c,d){return c*Math.pow(a/d,5)+b},p=function(a,b,c,d){return c*(Math.pow(a/d-1,5)+1)+b},q=function(a,b,c,d){return a=2*(a/d),1>a?c/2*Math.pow(a,5)+b:c/2*(Math.pow(a-2,5)+2)+b},r=function(a,b,c,d){return d/2>a?p(2*a,b,c/2,d):o(2*a-d,b+c/2,c/2,d)},t=function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},u=function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},v=function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},w=function(a,b,c,d){return d/2>a?u(2*a,b,c/2,d):t(2*a-d,b+c/2,c/2,d)},x=function(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b-.001*c},y=function(a,b,c,d){return a==d?b+c:1.001*c*(-Math.pow(2,-10*a/d)+1)+b},z=function(a,b,c,d){return 0===a?b:a==d?b+c:(a=2*(a/d),1>a?c/2*Math.pow(2,10*(a-1))+b-5e-4*c:1.0005*(c/2)*(-Math.pow(2,-10*(a-1))+2)+b)},A=function(a,b,c,d){return d/2>a?y(2*a,b,c/2,d):x(2*a-d,b+c/2,c/2,d)},B=function(a,b,c,d){return-c*(Math.sqrt(1-Math.pow(a/d,2))-1)+b},C=function(a,b,c,d){return c*Math.sqrt(1-Math.pow(a/d-1,2))+b},D=function(a,b,c,d){return a=2*(a/d),1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:(a-=2,c/2*(Math.sqrt(1-a*a)+1)+b)},E=function(a,b,c,d){return d/2>a?C(2*a,b,c/2,d):B(2*a-d,b+c/2,c/2,d)},F=function(a,b,c,d){return a=void 0===a?.3*d:a,b=b||0,Math.abs(c)>b?(b=c,s=a/4):s=a/(2*Math.PI)*Math.asin(c/b),[a,b,s]},G=function(a,b,c,d,e,f){if(0===a)return b;if(a/=d,1==a)return b+c;var g=F(f,e,c,d),h=g[2];return f=g[0],e=g[1],a-=1,-(e*Math.pow(2,10*a)*Math.sin(2*(a*d-h)*Math.PI/f))+b},H=function(a,b,c,d,e,f){if(0===a)return b;if(a/=d,1==a)return b+c;var g=F(f,e,c,d),h=g[2];return f=g[0],e=g[1],e*Math.pow(2,-10*a)*Math.sin(2*(a*d-h)*Math.PI/f)+c+b},I=function(a,b,c,d,e,f){if(0===a)return b;if(a/=d,1==a)return b+c;var g=F(f,e,c,d),h=g[2];return f=g[0],e=g[1],a-=1,0>a?-.5*e*Math.pow(2,10*a)*Math.sin(2*(a*d-h)*Math.PI/f)+b:.5*e*Math.pow(2,-10*a)*Math.sin(2*(a*d-h)*Math.PI/f)+c+b},J=function(a,b,c,d,e,f){return d/2>a?H(2*a,b,c/2,d,e,f):G(2*a-d,b+c/2,c/2,d,e,f)},K=function(a,b,c,d,e){return e=e||1.70158,a/=d,c*a*a*((e+1)*a-e)+b},L=function(a,b,c,d,e){return e=e||1.70158,a=a/d-1,c*(a*a*((e+1)*a+e)+1)+b},M=function(a,b,c,d,e){return e=1.525*(e||1.70158),a=2*(a/d),1>a?c/2*a*a*((e+1)*a-e)+b:(a-=2,c/2*(a*a*((e+1)*a+e)+2)+b)},N=function(a,b,c,d,e){return d/2>a?L(2*a,b,c/2,d,e):K(2*a-d,b+c/2,c/2,d,e)},O=function(a,b,c,d){return a/=d,1/2.75>a?7.5625*c*a*a+b:2/2.75>a?(a-=1.5/2.75,c*(7.5625*a*a+.75)+b):2.5/2.75>a?(a-=2.25/2.75,c*(7.5625*a*a+.9375)+b):(a-=2.625/2.75,c*(7.5625*a*a+.984375)+b)},P=function(a,b,c,d){return c-O(d-a,0,c,d)+b},Q=function(a,b,c,d){return d/2>a?.5*P(2*a,0,c,d)+b:.5*O(2*a-d,0,c,d)+.5*c+b},R=function(a,b,c,d){return d/2>a?O(2*a,b,c/2,d):P(2*a-d,b+c/2,c/2,d)};a.Timer.Tween.easing={linear:b,inQuad:c,outQuad:d,inOutQuad:e,outInQuad:f,inCubic:g,outCubic:h,inOutCubic:i,outInCubic:j,inQuart:k,outQuart:l,inOutQuart:m,outInQuart:n,inQuint:o,outQuint:p,inOutQuint:q,outInQuint:r,inSine:t,outSine:u,inOutSine:v,outInSine:w,inExpo:x,outExpo:y,inOutExpo:z,outInExpo:A,inCirc:B,outCirc:C,inOutCirc:D,outInCirc:E,inElastic:G,outElastic:H,inOutElastic:I,outInElastic:J,inBack:K,outBack:L,inOutBack:M,outInBack:N,inBounce:P,outBounce:O,inOutBounce:Q,outInBounce:R};var S=function(a,b,c){var d,e;for(var f in b)if(b.hasOwnProperty(f))if(d=typeof b[f],e=c.slice(0),e.push(f+""),"number"===d){if("number"!=typeof a[f])throw Error("Parameter '"+e.join("/")+"' is missing from 'from' or isn't a number")}else{if("object"!==d)throw Error("Parameter '"+e.join("/")+"' must be a number or string, was "+b[f]);S(a[f],b[f],e)}},T=function(a,b,c){var d;if("object"==typeof c){d=Array.isArray(c)?[]:{};for(var e in c)c.hasOwnProperty(e)&&(d[e]=T(a,b[e],c[e]))}else d=a.easing(a.runningTime,b,c-b,a.timeToFinish);return d},U=function(b){return b=b||"linear","string"==typeof b?a.Timer.Tween.easing[b]:b},V=function(a,b,c){if(c=c||b,"object"==typeof b){a=a||(Array.isArray(b)?[]:{});for(var d in b)b.hasOwnProperty(d)&&(a[d]=V(a[d],b[d],c[d]))}else a=b;return a},W=function(a,b){return V(null,a,b)}}(),function(){a.Keyboard=a.Class("Luv.Keyboard",{init:function(a){var b=this;return b.keysDown={},b.el=a,a.addEventListener("keydown",function(a){a.preventDefault(),a.stopPropagation();var c=e(a);b.keysDown[c]=!0,b.onPressed(c,a.which)}),a.addEventListener("keyup",function(a){a.preventDefault(),a.stopPropagation();var c=e(a);b.keysDown[c]=!1,b.onReleased(c,a.which)}),b},onPressed:function(){},onReleased:function(){},isDown:function(a){return!!this.keysDown[a]}});var b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",45:"insert",46:"delete",37:"left",38:"up",39:"right",40:"down",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},d={16:"rshift",17:"rctrl",18:"ralt"},e=function(a){var e,f=a.which;return e=a.keyLocation&&a.keyLocation>1?d[f]:a.shiftKey?c[f]||b[f]:b[f],void 0===e&&(e=String.fromCharCode(f),a.shiftKey&&(e=e.toUpperCase())),e}}(),function(){a.Mouse=a.Class("Luv.Mouse",{init:function(b){var e=this;e.x=0,e.y=0,e.pressedButtons={},e.wheelTimeOuts={};var f=function(a){e.pressedButtons[a]=!0,e.onPressed(e.x,e.y,a)},g=function(a){e.pressedButtons[a]=!1,e.onReleased(e.x,e.y,a)},h=function(b){b.preventDefault();var c=d(b);clearTimeout(e.wheelTimeOuts[c]),e.wheelTimeOuts[c]=setTimeout(function(){g(c)},1e3*a.Mouse.WHEEL_TIMEOUT),f(c)};b.addEventListener("mousemove",function(a){var c=b.getBoundingClientRect();e.x=a.pageX-c.left,e.y=a.pageY-c.top,e.onMoved(e.x,e.y)}),b.addEventListener("mousedown",function(a){f(c(a))}),b.addEventListener("mouseup",function(a){g(c(a))}),b.addEventListener("DOMMouseScroll",h),b.addEventListener("mousewheel",h)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(a){return!!this.pressedButtons[a]}}),a.Mouse.WHEEL_TIMEOUT=.02;var b={1:"l",2:"m",3:"r"},c=function(a){return b[a.which]},d=function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));return 1===b?"wu":"wd"}}(),function(){a.Touch=a.Class("Luv.Touch",{init:function(a){var b=this;b.fingers={},b.el=a;var e=function(a){a.preventDefault(),a.stopPropagation()};a.addEventListener("gesturestart",e),a.addEventListener("gesturechange",e),a.addEventListener("gestureend",e),a.addEventListener("touchstart",function(f){e(f);for(var g,h,i=a.getBoundingClientRect(),j=0;f.targetTouches.length>j;j++)g=f.targetTouches[j],h=d(b,g.identifier),h||(h={identifier:g.identifier,position:c(b),x:g.pageX-i.left,y:g.pageY-i.top},b.fingers[h.position]=h,b.onPressed(h.position,h.x,h.y))});var f=function(c){e(c);var f,g;a.getBoundingClientRect();for(var h=0;c.changedTouches.length>h;h++)f=c.changedTouches[h],g=d(b,f.identifier),g&&(delete b.fingers[g.position],b.onReleased(g.position,g.x,g.y))};a.addEventListener("touchend",f),a.addEventListener("touchleave",f),a.addEventListener("touchcancel",f),a.addEventListener("touchmove",function(c){e(c);for(var f,g,h=a.getBoundingClientRect(),i=0;c.targetTouches.length>i;i++)f=c.targetTouches[i],g=d(b,f.identifier),g&&(g.x=f.pageX-h.left,g.y=f.pageY-h.top,b.onMoved(g.position,g.x,g.y))})},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(a){return!!this.fingers[a]},getFinger:function(a){var b=this.fingers[a];return b&&{position:b.position,identifier:b.identifier,x:b.x,y:b.y}},getFingers:function(){for(var a,b,c=[],d=Object.keys(this.fingers).sort(),e=0;d.length>e;e++)b=d[e],a=this.fingers[b],c.push({position:b,x:a.x,y:a.y});return c},isAvailable:function(){return void 0!==window.ontouchstart}});var b=function(a){var b=Object.keys(a.fingers);return 0===b.length?0:Math.max.apply(Math,b)},c=function(a){for(var c=b(a),d=1;c>d;d++)if(!a.isPressed(d))return d;return c+1},d=function(a,b){var c=a.fingers;for(var d in c)if(c.hasOwnProperty(d)&&c[d].identifier==b)return c[d]}}(),function(){a.Media=a.Class("Luv.Media",{init:function(){this.pending=0,this.loaded=!0},isLoaded:function(){return this.loaded},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(a){throw Error("Could not load "+a)},onLoaded:function(){},newAsset:function(a){this.pending++,this.loaded=!1,clearTimeout(this.onLoadedTimeout),a.status="pending"},registerLoad:function(b){if(this.pending--,b.status="loaded",this.onAssetLoaded(b),0===this.pending){var c=this;clearTimeout(this.onLoadedTimeout),this.onLoadedTimeout=setTimeout(function(){c.loaded=!0,c.onLoaded()},a.Timer.ONLOAD_TIMEOUT)}},registerError:function(a){this.pending--,a.status="error",this.onAssetError(a)}}),a.Timer.ONLOAD_TIMEOUT=200,a.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){a.Audio=a.Class("Luv.Audio",{init:function(a){this.media=a},isAvailable:function(){return a.Audio.isAvailable()},getSupportedTypes:function(){return a.Audio.getSupportedTypes()},canPlayType:function(a){return this.supportedTypes[a.toLowerCase()]},Sound:function(){if(this.isAvailable()){var b=[this.media].concat(Array.prototype.slice.call(arguments,0));return a.Audio.Sound.apply(a.Audio.Sound,b)}return a.Audio.NullSound()}}),a.Audio.isAvailable=function(){return d},a.Audio.canPlayType=function(a){return!!c[a.toLowerCase()]},a.Audio.getSupportedTypes=function(){return Object.keys(c)};var b=document.createElement("audio"),c={},d=!!b.canPlayType;d&&(c.ogg=!!b.canPlayType('audio/ogg; codecs="vorbis"'),c.mp3=!!b.canPlayType("audio/mpeg;"),c.wav=!!b.canPlayType('audio/wav; codecs="1"'),c.m4a=!!b.canPlayType("audio/x-m4a;"),c.aac=!!b.canPlayType("audio/aac;"))}(),function(){a.Audio.Sound=a.Class("Luv.Audio.Sound",{init:function(b){var c=Array.prototype.slice.call(arguments,1);if(0===c.length)throw Error("Must provide at least one path for the Sound");if(c=c.filter(f),0===c.length)throw Error("None of the provided sound types ("+c.join(", ")+") is supported by the browser: ("+a.Audio.getSupportedTypes().join(", ")+")");var d=this;d.path=c[0],b.newAsset(d);var e=d.el=document.createElement("audio");e.preload="auto",e.addEventListener("canplaythrough",function(){d.isLoaded()||b.registerLoad(d)}),e.addEventListener("error",function(){b.registerError(d)}),e.src=d.path,e.load(),d.instances=[],d.expirationTime=a.Audio.Sound.DEFAULT_EXPIRATION_TIME},toString:function(){return'Luv.Audio.Sound("'+this.path+'")'},play:function(a){if(!this.isLoaded())throw Error("Attepted to play a non loaded sound: "+this);var b=this.getReadyInstance(a);return b.play(),b},pause:function(){this.instances.forEach(function(a){a.pause()})},stop:function(){this.instances.forEach(function(a){a.stop()})},countInstances:function(){return this.instances.length},countPlayingInstances:function(){var a=0;return this.instances.forEach(function(b){a+=b.isPlaying()?1:0}),a},getReadyInstance:function(a){var d=b(this.instances);return d||(d=c(this),this.instances.push(d)),d.reset(this.el,a),d},getExpirationTime:function(){return this.expirationTime},setExpirationTime:function(a){this.expirationTime=a}}),a.Audio.Sound.DEFAULT_EXPIRATION_TIME=3,a.Audio.Sound.include(a.Media.Asset),a.Audio.SoundMethods={setVolume:function(a){a=g(a,0,1),this.el.volume=a},getVolume:function(){return this.el.volume},setLoop:function(a){this.loop=!!a,a?this.el.loop="loop":this.el.removeAttribute("loop")},getLoop:function(){return this.loop},setSpeed:function(a){this.el.playbackRate=a},getSpeed:function(){return this.el.playbackRate},setTime:function(a){try{this.el.currentTime=a}catch(b){}},getTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration}},a.Audio.Sound.include(a.Audio.SoundMethods);var b=function(a){for(var b,c=0;a.length>c;c++)if(b=a[c],b.isReady())return b},c=function(b){return a.Audio.SoundInstance(b.el.cloneNode(!0),function(){clearTimeout(this.expirationTimeOut)},function(){var a=this;a.expirationTimeOut=setTimeout(function(){d(b,a)},1e3*b.getExpirationTime())})},d=function(a,b){var c=a.instances.indexOf(b);-1!=c&&a.instances.splice(c,1)},e=function(a){var b=a.match(/.+\.([^?]+)(\?|$)/);return b?b[1].toLowerCase():""},f=function(b){return a.Audio.canPlayType(e(b))},g=function(a,b,c){return Math.max(b,Math.min(c,Number(a)))}}(),function(){a.Audio.SoundInstance=a.Class("Luv.Audio.SoundInstance",{init:function(a,b,c){var d=this;d.el=a,d.onPlay=b,d.onStop=c,d.el.addEventListener("ended",function(){d.stop()})},reset:function(a,b){b=b||{};var c=void 0===b.volume?a.volume:b.volume,d=void 0===b.loop?!!a.loop:b.loop,e=void 0===b.speed?a.playbackRate:b.speed,f=void 0===b.time?a.currentTime:b.time,g=void 0===b.status?"ready":b.status;this.setVolume(c),this.setLoop(d),this.setSpeed(e),this.setTime(f),this.status=g},play:function(){this.el.play(),this.status="playing",this.onPlay()},pause:function(){this.isPlaying()&&(this.el.pause(),this.status="paused")},stop:function(){this.el.pause(),this.setTime(0),this.status="ready",this.onStop()},isPaused:function(){return"paused"==this.status},isReady:function(){return"ready"==this.status},isPlaying:function(){return"playing"==this.status},onPlay:function(){},onStop:function(){}}),a.Audio.SoundInstance.include(a.Audio.SoundMethods)}(),function(){a.Audio.NullSound=a.Class("Luv.Audio.NullSound");var b={},c=function(){return 0};for(var d in a.Audio.Sound.methods)a.Audio.Sound.methods.hasOwnProperty(d)&&(b[d]=c);a.Audio.NullSound.include(b,{play:function(){return a.Audio.SoundInstance(e())}});var e=function(){return{volume:1,playbackRate:1,loop:void 0,currentTime:0,play:function(){},pause:function(){},addEventListener:function(a,b){b()}}}}(),function(){a.Graphics=a.Class("Luv.Graphics",{init:function(a,b){this.el=a,this.media=b},parseColor:function(b,c,d){return a.Graphics.parseColor(b,c,d)},Canvas:function(b,c){return b=b||this.el.getAttribute("width"),c=c||this.el.getAttribute("height"),a.Graphics.Canvas(b,c)},Image:function(b){return a.Graphics.Image(this.media,b)},Sprite:function(b,c,d,e,f){return a.Graphics.Sprite(b,c,d,e,f)},SpriteSheet:function(b,c,d,e,f,g){return a.Graphics.SpriteSheet(b,c,d,e,f,g)}}),a.Graphics.parseColor=function(a,b,c){var d,e=parseInt;if(Array.isArray(a))return{r:a[0],g:a[1],b:a[2]};if("object"==typeof a)return{r:a.r,g:a.g,b:a.b};if("string"==typeof a){if(a=a.replace(/#|\s+/g,""),d=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a))return{r:e(d[1],16),g:e(d[2],16),b:e(d[3],16)};if(d=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a))return{r:17*e(d[1],16),g:17*e(d[2],16),b:17*e(d[3],16)};if(d=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a))return{r:e(d[1],10),g:e(d[2],10),b:e(d[3],10)}}return{r:a,g:b,b:c}}}(),function(){a.Graphics.Animation=a.Class("Luv.Graphics.Animation",{init:function(a,c){if(!Array.isArray(a))throw Error("Array of sprites needed. Got "+a);if(0===a.length)throw Error("No sprites where provided. Must provide at least one");this.sprites=a.slice(0),this.time=0,this.index=0,this.durations=d(a.length,c),this.intervals=b(this.durations),this.loopDuration=this.intervals[this.intervals.length-1]},update:function(a){var b;this.time+=a,b=Math.floor(this.time/this.loopDuration),this.time-=this.loopDuration*b,0!==b&&this.onLoopEnded(b),this.index=c(this.intervals,this.time)},gotoSprite:function(a){this.index=a,this.time=this.intervals[a]},getCurrentSprite:function(){return this.sprites[this.index]},onLoopEnded:function(){}}),"getWidth getHeight getDimensions getCenter drawInCanvas".split(" ").forEach(function(b){a.Graphics.Animation.methods[b]=function(){var a=this.getCurrentSprite();return a[b].apply(a,arguments)}});var b=function(a){for(var b=[0],c=0,d=0;a.length>d;d++)c+=a[d],b.push(c);return b},c=function(a,b){for(var c=a.length-2,d=0,e=0;c>=d;)if(e=Math.floor((d+c)/2),b>=a[e+1])d=e+1;else{if(!(a[e]>b))break;c=e-1}return e},d=function(a,b){var c,d,f,g,h=[];if(Array.isArray(b))h=b.slice(0);else if("object"==typeof b){h.length=a;for(c in b)if(b.hasOwnProperty(c))for(f=e(c),g=Number(b[c]),d=0;f.length>d;d++)h[f[d]]=g}else for(b=Number(b),d=0;a>d;d++)h.push(b);if(h.length!=a)throw Error("The durations table length should be "+a+", but it is "+h.length);for(d=0;h.length>d;d++){if(void 0===h[d])throw Error("Missing delay for sprite "+d);if(isNaN(h[d]))throw Error("Could not parse the delay for sprite "+d)}return h},e=function(a){var b,c,d,e,f;if("string"!=typeof a)throw Error("Unknown range type (must be integer or string in the form 'start-end'): "+a);if(b=a.match(/^(\d+)-(\d+)$/))if(c=[],d=Number(b[1]),e=Number(b[2]),e>d)for(f=d;e>=f;f++)c.push(f);else for(f=d;f>=e;f--)c.push(f);else c=[Number(a)];return c}}(),function(){a.Graphics.Canvas=a.Class("Luv.Graphics.Canvas",{init:function(a,b){var c;a.getAttribute?(c=a,a=c.getAttribute("width"),b=c.getAttribute("height")):(c=document.createElement("canvas"),c.setAttribute("width",a),c.setAttribute("height",b)),this.el=c,this.ctx=c.getContext("2d"),this.color={},this.backgroundColor={},this.setBackgroundColor(0,0,0),this.setColor(255,255,255),this.setLineCap("butt"),this.setLineWidth(1),this.setImageSmoothing(!0),this.setAlpha(1)},clear:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.globalAlpha=1,this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight()),this.ctx.restore()},print:function(a,b,c){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(a,b,c)},line:function(){var a=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),e(this,"luv.graphics.line",4,a),h(this,m.STROKE)},strokeRectangle:function(a,b,c,d){i(this,m.STROKE,a,b,c,d)},fillRectangle:function(a,b,c,d){i(this,m.FILL,a,b,c,d)},strokePolygon:function(){j(this,m.STROKE,arguments)},fillPolygon:function(){j(this,m.FILL,arguments)},strokeCircle:function(a,b,c){l(this,m.STROKE,a,b,c)},fillCircle:function(a,b,c){l(this,m.FILL,a,b,c)},strokeArc:function(a,b,c,d,e){k(this,m.STROKE,a,b,c,d,e)},fillArc:function(a,b,c,d,e){k(this,m.FILL,a,b,c,d,e)},draw:function(a,b,c,d,e,g,h,i){var j=this.ctx;b=b||0,c=c||0,e=e||1,g=g||1,h=h||0,i=i||0,d=f(d||0),0!==d||1!==e||1!==g||0!==h||0!==i?(j.save(),j.translate(b,c),j.translate(h,i),j.rotate(d),j.scale(e,g),j.translate(-h,-i),a.drawInCanvas(this,0,0),j.restore()):a.drawInCanvas(this,b,c)},drawCentered:function(a,b,c,d,e,f){var g=a.getCenter();this.draw(a,b-g.x,c-g.y,d,e,f,g.x,g.y)},drawInCanvas:function(a,b,c){a.ctx.drawImage(this.el,b,c)},translate:function(a,b){this.ctx.translate(a,b)},scale:function(a,b){this.ctx.scale(a,b)},rotate:function(a){this.ctx.rotate(a)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(a,b){this.el.setAttribute("width",a),this.el.setAttribute("height",b)},getWidth:function(){return Number(this.el.getAttribute("width"))},getHeight:function(){return Number(this.el.getAttribute("height"))},getCenter:function(){return{x:this.getWidth()/2,y:this.getHeight()/2}},setColor:function(a,b,d){c(this,"color",a,b,d)},getColor:function(){return d(this.color)},setBackgroundColor:function(a,b,d){c(this,"backgroundColor",a,b,d)},getBackgroundColor:function(){return d(this.backgroundColor)},setAlpha:function(a){this.alpha=n(a,0,1),this.ctx.globalAlpha=this.alpha},getAlpha:function(){return this.alpha},setLineWidth:function(a){this.lineWidth=a,this.ctx.lineWidth=a},getLineWidth:function(){return this.lineWidth},setLineCap:function(a){if("butt"!=a&&"round"!=a&&"square"!=a)throw Error("Line cap must be either 'butt', 'round' or 'square' (was: "+a+")");this.ctx.lineCap=a,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},setImageSmoothing:function(a){this.imageSmoothing=a=!!a,g(this.ctx,a)},getImageSmoothing:function(){return this.imageSmoothing}});var b=2*Math.PI,c=function(b,c,d,e,f){var g=b[c],h=a.Graphics.parseColor(d,e,f);a.extend(g,h),b[c+"Style"]="rgb("+[g.r,g.g,g.b].join()+")"},d=function(a){return{r:a.r,g:a.g,b:a.b}},e=function(a,b,c,d){if(c>d.length)throw Error(b+" requires at least 4 parameters");if(1==d.length%2)throw Error(b+" requires an even number of parameters");a.ctx.moveTo(d[0],d[1]);for(var e=2;d.length>e;e+=2)a.ctx.lineTo(d[e],d[e+1]);a.ctx.stroke()},f=function(a){return a%=b,0>a?a+b:a},g=function(a,b){a.webkitImageSmoothingEnabled=b,a.mozImageSmoothingEnabled=b,a.imageSmoothingEnabled=b},h=function(a,b){switch(b){case m.FILL:a.ctx.fillStyle=a.colorStyle,a.ctx.fill();break;case m.STROKE:a.ctx.strokeStyle=a.colorStyle,a.ctx.stroke();break;default:throw Error("Invalid mode: ["+b+']. Should be "fill" or "line"')}},i=function(a,b,c,d,e,f){a.ctx.beginPath(),a.ctx.rect(c,d,e,f),h(a,b),a.ctx.closePath()},j=function(a,b,c){var d=Array.isArray(c[0])?c[0]:Array.prototype.slice.call(c,0);a.ctx.beginPath(),e(a,"luv.Graphics.Canvas.polygon",6,d),h(a,b),a.ctx.closePath()},k=function(a,b,c,d,e,f,g){a.ctx.beginPath(),a.ctx.arc(c,d,e,f,g,!1),h(a,b)},l=function(a,c,d,e,f){k(a,c,d,e,f,0,b),a.ctx.closePath()},m={STROKE:1,FILL:2},n=function(a,b,c){return Math.max(b,Math.min(c,Number(a)))}}(),function(){a.Graphics.Image=a.Class("Luv.Graphics.Image",{init:function(a,b){var c=this;c.path=b,a.newAsset(c);var d=new Image;c.source=d,d.addEventListener("load",function(){a.registerLoad(c)}),d.addEventListener("error",function(){a.registerError(c)}),d.src=b},toString:function(){return'instance of Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}},getCenter:function(){return{x:this.source.width/2,y:this.source.height/2}},drawInCanvas:function(a,b,c){if(!this.isLoaded())throw Error("Attepted to draw a non loaded image: "+this);a.ctx.drawImage(this.source,b,c)}}),a.Graphics.Image.include(a.Media.Asset)}(),function(){a.Graphics.Sprite=a.Class("Luv.Graphics.Sprite",{init:function(a,b,c,d,e){this.image=a,this.left=b,this.top=c,this.width=d,this.height=e},toString:function(){return["instance of Luv.Graphics.Sprite(",this.image,", ",this.left,", ",this.top,", ",this.width,", ",this.height,")"].join("")},getImage:function(){return this.image},getWidth:function(){return this.width},getHeight:function(){return this.height},getDimensions:function(){return{width:this.width,height:this.height}},getCenter:function(){return{x:this.width/2,y:this.height/2}},getBoundingBox:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}},drawInCanvas:function(a,b,c){if(!this.image.isLoaded())throw Error("Attepted to draw a prite of a non loaded image: "+this);a.ctx.drawImage(this.image.source,this.left,this.top,this.width,this.height,b,c,this.width,this.height)}})}(),function(){a.Graphics.SpriteSheet=a.Class("Luv.Graphics.SpriteSheet",{init:function(a,b,c,d,e,f){this.image=a,this.width=b,this.height=c,this.left=d||0,this.top=e||0,this.border=f||0},getSprites:function(){for(var a,c,d=[],e=0;arguments.length>e;e+=2){a=b(arguments[e]),c=b(arguments[e+1]);for(var f=0;c.length>f;f++)for(var g=0;a.length>g;g++)d.push(this.Sprite(a[g],c[f]))}return d},Sprite:function(b,c){return a.Graphics.Sprite(this.image,this.left+this.width*b+this.border*(b+1),this.top+this.height*c+this.border*(c+1),this.width,this.height)},Animation:function(b,c){var d=this.getSprites.apply(this,b);return a.Graphics.Animation(d,c)}});var b=function(a){if("number"==typeof a)return[a];if("string"==typeof a){var b=a.split("-");if(2!=b.length)throw Error("Could not parse from '"+a+"'. Must be of the form 'start-end'");var c,d=[],e=Number(b[0]),f=Number(b[1]);if(f>e)for(c=e;f>=c;c++)d.push(c);else for(c=e;c>=f;c--)d.push(c);return d}throw Error("Ranges must be integers or strings of the form 'start-end'. Got "+a)}}(),a});var RL={States:{},sounds:{},hittableNotes:[!1,!1,!1,!1,!1,!1],pressedButtons:[!1,!1,!1,!1,!1,!1],playAdded:!1,init:function(){RL.editMode=RL.isEditMode(),RL.playerHeightOnePercent=RL.config.height/100,restart=!1,null!=game&&(game.destroy(),
AudioManager.stop(),createjs.Sound.removeAllSounds(),RL.hittableNotes=[!1,!1,!1,!1,!1,!1],RL.pressedButtons=[!1,!1,!1,!1,!1,!1],$("#main-canvas canvas").remove(),$(".counter-overlay .count").hide().html(RL.config.countSeconds),$(".counter-overlay .info").fadeIn(),game=null,restart=!0),RL.config.pxPerMs=RL.config.pxPerSecond/1e3,RL.negPxPerMs=-RL.config.pxPerMs,RL.msOnScreen=RL.config.height/RL.config.pxPerMs,EditorManager=new RL.EditorManager,AudioManager=new RL.AudioManager,HighwayManager=new RL.HighwayManager,HighwayManager.aNotes=aNotes,InteractionManager=new RL.InteractionManager,RL.editMode&&(EditorInteractionManager=new RL.InteractionManager.Editor),ScoreManager=new RL.ScoreManager;var a=Phaser.AUTO;switch(RL.config.displayMode){case"AUTO":a=Phaser.AUTO;break;case"WEBGL":a=Phaser.WEBGL;break;case"CANVAS":a=Phaser.CANVAS}game=new Phaser.Game(this.config.width,this.config.height,a,"main-canvas",null,!1,!0,null),game.state.add("Boot",RL.States.Boot),game.state.add("Play",RL.States.Play),game.state.add("Editor",RL.States.Editor),WebFontConfig={active:function(){game.time.events.add(Phaser.Timer.SECOND,RL.HighwayManager.createText,this)},google:{families:["Roboto"]}},game.state.start("Boot")},getPosXForLane:function(a){return RL.config.width/(RL.config.lanes+1)*a},getLaneForX:function(a,b){for(var c=0;c<=RL.config.lanes;++c){var d=RL.config.width/RL.config.lanes*c-RL.config.buttonWidth/2,d=d+RL.config.noteWidth;if(d>=a)return c}return 6},getTimeForY:function(a){return(a-RL.config.noteHeightDifferenceToButton)/RL.negPxPerMs},getPosXForLane:function(a){return RL.config.width/6*a},getXForLaneButton:function(a){return RL.config.width/6*a-RL.config.noteWidth/2},getYForTime:function(a){return a*RL.negPxPerMs+RL.config.noteHeightDifferenceToButton},getSpriteForLane:function(a){return game.cache.getImage("note_lane"+a)},addPlay:function(){$.post("/play/add/"+track_id)},sortNotesArray:function(){for(var a=1;a<aNotes.length;a++){lane=aNotes[a];for(var b=0;b<lane.length;b++)lane[b].ms=lane[b].ms;lane.sort(RL.dynamicSort("ms"))}},keyCodeToIndex:function(a){var b=0;switch(a){case RL.config.buttonKeys[0]:b=0;break;case RL.config.buttonKeys[1]:b=1;break;case RL.config.buttonKeys[2]:b=2;break;case RL.config.buttonKeys[3]:b=3;break;case RL.config.buttonKeys[4]:b=4;break;case RL.config.buttonKeys[5]:b=5;break;case RL.config.buttonKeys[6]:b=6;break;default:b=-1}return b},isEditMode:function(){return"undefined"!=typeof edit_mode&&edit_mode?!0:!1},dynamicSort:function(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c[a]<d[a]?-1:c[a]>d[a]?1:0;return e*b}},str_pad:function(a,b,c,d){var e,f="",g=function(a,b){for(var c="";c.length<b;)c+=a;return c=c.substr(0,b)};return a+="",c=void 0!==c?c:" ","STR_PAD_LEFT"!==d&&"STR_PAD_RIGHT"!==d&&"STR_PAD_BOTH"!==d&&(d="STR_PAD_RIGHT"),(e=b-a.length)>0&&("STR_PAD_LEFT"===d?a=g(c,e)+a:"STR_PAD_RIGHT"===d?a+=g(c,e):"STR_PAD_BOTH"===d&&(f=g(c,Math.ceil(e/2)),a=f+a+f,a=a.substr(0,b))),a}};Array.prototype.AllValuesSame=function(){if(this.length>0)for(var a=1;a<this.length;a++)if(this[a]!==this[0])return!1;return!0},RL.config={log:!0,mobile:!1,editor:!1,countSeconds:3,width:$("#main-canvas").width(),height:$("#main-canvas").height(),disableVisibilityChange:!0,smoothSprites:!1,stageBackgroundColor:2894892,loaderWidth:40,loaderHeight:40,squeaks:1,musicPlaybackRate:1,gridLineWidth:2,lanes:5,laneColors:[null,13708111,13943808,8967936,48099,8468473],buttonWidth:39.5,buttonHeight:45,buttonY:$("#main-canvas").height()-80,buttonKeys:[null,49,50,51,52,53,13],noteWidth:35,noteHeight:35,noteButtonOffsetY:0,noteHeightDifferenceToButton:8,pxPerSecond:250,longNoteThreshold:75,hitDetectThreshold:50,startKey:32,seekBackwardKey:37,seekForwardKey:39,speedUpKey:38,speedDownKey:40,deleteKey:46,newLineKey:187,mode:"tap",showBurst:!0,animateHitLanes:!0,drawKeys:!0,displayMode:"AUTO"},jQuery.extend(RL.config,user_config),RL.InteractionManager=function(){return{playing:!1,aKeyboardEvents:[],keyboardPresses:[0,0,0,0,0,0],strumDuration:[0,0,0,0,0,0],init:function(){game.input.touch.preventDefault=!1;var a=game.input.keyboard.addKey(32);a.onDown.add(this.togglePlayback,this)},togglePlayback:function(){RL.editMode?this.playing?(AudioManager.pause(),jQuery(".audio-controls .toggle-playback").addClass("paused"),this.playing=!1):(AudioManager.play(),jQuery(".audio-controls .toggle-playback").removeClass("paused"),this.playing=!0):this.playing||$("input, textarea").is(":focus")||(this.playing=!0,HighwayManager.countIn(!0))}}},RL.AudioManager=function(){return{duration:0,halfTime:0,onePercent:0,muted:!1,init:function(){this.duration=this.getDuration(),this.onePercent=this.duration/100,this.halfTime=this.duration/2},setPosition:function(a){0>=a?a=0:a>=AudioManager.getDuration()&&(a=AudioManager.getDuration()),RL.music.setPosition(a);for(var b=0;b<aNotes.length;b++){lane=aNotes[b];for(var c=0;c<lane.length;c++)lane[c].ticked=!1}},getPosition:function(a){var b=RL.music.position;return AudioManager.currentTime=b,b},getDuration:function(){return RL.music.duration},getPlaybackRate:function(){return RL.music._playbackResource.playbackRate},setPlaybackRate:function(a){RL.music._playbackResource.playbackRate=a,jQuery('input[name="playbackRate"]').val(a.toFixed(2))},toggleMute:function(){this.muted?(RL.music.muted=!1,this.muted=!1):(RL.music.muted=!0,this.muted=!0)},pause:function(){RL.music.paused=!0},stop:function(){return RL.music.stop()},play:function(){RL.music.play()}}},RL.EditorManager=function(){return{aTaps:[[],[],[],[],[],[]],aMsTapped:[[],[],[],[],[],[]],aSelectedNotes:[],aPreviousSelection:[],aCopiedNotes:[],selectedNote:!1,positionSlider:!1,playbackRateSlider:!1,pxPerSecondSlider:!1,auto_save:RL.config.auto_save,auto_save_interval:RL.config.auto_save_interval,auto_save_js_interval:null,notesChanged:0,playTicks:!1,advancedMode:!1,beatsInitialized:!1,beatLineContainer:!1,aBeatLines:0,beatLinesHeight:0,beatLineTextContainer:!1,timeSignature:[4,4],secondsPerMeasure:0,gridSecondsPerNote:0,grid:.25,grid_snap:!1,grid_snap_sustained:!1,dragging:!1,newLine:function(){newTime=AudioManager.getPosition()+this.secondsPerNote,newTime<0&&(newTime=0),AudioManager.setPosition(newTime)},init:function(){this.beatLineContainer=game.add.group(game,game.world,"beatLineContainer",!0,!1),this.beatLineContainer.z=100,this.beatLineTextContainer=game.add.group(game,game.world,"beatLineTextContainer",!0,!1),this.beatLineTextContainer.z=50,this.auto_save&&this.toggleAutoSave(),tval=this.auto_save_interval+" seconds",this.auto_save_interval>=60&&(tval=parseFloat(this.auto_save_interval/60).toFixed(1)+" minutes"),jQuery("#auto-save-interval").html(tval),"undefined"!=typeof RL.config.fetchNotes&&RL.config.fetchNotes&&this.getNotesForTrack(),EditorInteractionManager.init()},deleteBeatLines:function(){this.beatLineContainer.removeAll(),this.beatLineTextContainer.removeAll(),this.aBeatLines=0},drawBeatLines:function(a){var b=this.grid,c=RL.config.pxPerSecond,d=AudioManager.duration/1e3/b,e=new Phaser.Graphics(game,0,0);if(a||this.aBeatLines<d){this.deleteBeatLines();for(var f=this.aBeatLines;d>=f;f+=b)y=-Math.round(f*c),e.lineStyle(1,16777215,f%1==0?1:.35),e.moveTo(0,y),e.lineTo(RL.config.width,y),e.time=parseFloat(f),this.aBeatLines++,time=parseFloat(f).toFixed(3),timeText=time,time>=60&&(seconds=f,minutes=parseInt(seconds/60),seconds=parseFloat(seconds-60*minutes).toFixed(3),timeText=minutes+":"+seconds),text=game.add.text(4,y-12,timeText,{fill:"#ffffff",fontSize:10,font:"Roboto"},this.beatLineTextContainer),text.alpha=f%1==0?1:.35,text.exists=!1,text.time=1e3*time,text.update=function(){this.time>AudioManager.currentTime+RL.msOnScreen||this.time<AudioManager.currentTime-250?this.exists=!1:this.exists=!0};this.beatLineContainer.add(e),this.beatLinesHeight=Math.round(f*c),this.beatLinesTime=f}},addTap:function(a,b,c){if(this.beatsInitialized&&this.grid_snap&&(b=this.calculateBPMTime(b)),jQuery.inArray(b,this.aMsTapped[a])<=-1){var d=new RL.Note(game,{time:b,lane:a,hopo:c});return d.exists=!0,noteContainer.add(d),HighwayManager.aNotes[a].push(d),d.initEditorFunctions(),d}},calculateBPMTime:function(a){return snap=this.secondsPerBeat*(this.timeSignature[0]/this.grid_snap_bottom)*1e3,a.roundTo(snap)},holdTap:function(a,b,c,d){if(aNotes=HighwayManager.aNotes[a],this.beatsInitialized&&this.grid_snap&&(c=this.calculateBPMTime(c)),b>RL.config.longNoteThreshold){noteIndex=aNotes.length-1,c=HighwayManager.aNotes[a][noteIndex].time,HighwayManager.aNotes[a][noteIndex].kill(!0),HighwayManager.aNotes[a].splice(noteIndex,1);var e=new RL.Note(game,{time:c,lane:a,duration:b,hopo:d,showRect:!0});e.exists=!0,noteContainer.add(e),HighwayManager.aNotes[a].push(e),e.initEditorFunctions()}},finishTap:function(a,b,c){aNotes=HighwayManager.aNotes[a],noteIndex=aNotes.length-1,"undefined"!=typeof HighwayManager.aNotes[a][noteIndex].rect&&(HighwayManager.aNotes[a][noteIndex].rect.alpha=.5)},onNoteDown:function(a,b,c){var c="undefined"!=typeof c?c:!1;if(EditorManager.selectedNote=!0,null!=game.input.keyboard.event)var d=game.input.keyboard.event.shiftKey;else d=!1;if(c||d||a.isSelected||EditorManager.resetSelectedNotes(),a.isSelected){for(var e=0;e<EditorManager.aSelectedNotes.length;e++)EditorManager.aSelectedNotes[e]==a&&(a.isSelected=!1,EditorManager.aSelectedNotes.splice(e,1));a.setDefaultTexture()}else a.isSelected=!0,a.setDefaultTexture(),EditorManager.aSelectedNotes.push(a);EditorManager.updateNoteInfo(),EditorManager.aPreviousSelection=EditorManager.aSelectedNotes.slice()},resetSelectedNotes:function(a){for(var b=0;b<this.aSelectedNotes.length;b++)this.aSelectedNotes[b].isSelected=!1,this.aSelectedNotes[b].setDefaultTexture();this.aSelectedNotes=[],EditorManager.updateNoteInfo()},activatePreviousSelection:function(a){EditorManager.resetSelectedNotes();for(var b=0;b<EditorManager.aPreviousSelection.length;b++)EditorManager.onNoteDown(EditorManager.aPreviousSelection[b],null,!0)},onNoteUp:function(a,b){var c=b.timeUp-b.timeDown;if(c>=200){EditorManager.aSelectedNotes=[];for(var d=0;d<HighwayManager.aNotes.length;d++)for(var e=HighwayManager.aNotes[d],f=0;f<e.length;f++)e[f].isSelected&&(e[f].isSelected=!1,EditorManager.onNoteDown(e[f],b,!0))}else a.setDefaultTexture()},updateNoteInfo:function(){selectedNotes=EditorManager.aSelectedNotes,durations=[],times=[],lanes=[],hopos=[],durationDifferent=!1,timeDifferent=!1,laneDifferent=!1,hoposDifferent=!1,nonFalse=0;for(var a=0;a<selectedNotes.length;a++)durations.push(selectedNotes[a].duration),times.push(selectedNotes[a].time),lanes.push(selectedNotes[a].lane),hopos.push(selectedNotes[a].hopo),selectedNotes[a]&&nonFalse++;durations.AllValuesSame()||(durationDifferent=!0),times.AllValuesSame()||(timeDifferent=!0),lanes.AllValuesSame()||(laneDifferent=!0),hopos.AllValuesSame()||(hoposDifferent=!0),$(".var-sel-count").text(nonFalse),selectedNotes.length<=0?($("#sel-note-time").attr("readonly",!0).val("-"),$("#sel-note-duration").attr("readonly",!0).val("-"),$("#sel-note-lane").attr("readonly",!0).val("-"),$("#sel-note-hopo").attr("readonly",!0).prop("checked",!1),$("#copy-selected, #paste-copied").hide()):($("#copy-selected").show(),$("#sel-note-time").attr("readonly",!1).val(timeDifferent?"":selectedNotes[0].time),$("#sel-note-duration").attr("readonly",!1).val(durationDifferent?"":selectedNotes[0].duration),$("#sel-note-lane").attr("readonly",!1).val(laneDifferent?"":selectedNotes[0].lane),hoposDifferent?$("#sel-note-hopo").attr("readonly",!1).prop("checked",!1):selectedNotes[0].hopo?$("#sel-note-hopo").attr("readonly",!1).prop("checked",!0):$("#sel-note-hopo").attr("readonly",!1).prop("checked",!1))},copyNotes:function(a){EditorManager.aCopyNotes=[];for(var b=0;b<EditorManager.aSelectedNotes.length;b++)EditorManager.aSelectedNotes[b]&&EditorManager.aCopyNotes.push(EditorManager.aSelectedNotes[b]);$("#copy-info").html(EditorManager.aCopyNotes.length+" notes copied"),$("#paste-copied").show()},pasteNotes:function(a){var b=AudioManager.getPosition();EditorManager.resetSelectedNotes(),minTime=!1;for(var c=0;c<EditorManager.aCopyNotes.length;c++)(minTime===!1||EditorManager.aCopyNotes[c].time<minTime)&&(minTime=EditorManager.aCopyNotes[c].time);for(var c=0;c<EditorManager.aCopyNotes.length;c++){var d=EditorManager.aCopyNotes[c].time-minTime+b,e=new RL.Note(game,{time:d,lane:EditorManager.aCopyNotes[c].lane,duration:EditorManager.aCopyNotes[c].duration,hopo:EditorManager.aCopyNotes[c].hopo});e.exists=!0,noteContainer.add(e),HighwayManager.aNotes[EditorManager.aCopyNotes[c].lane].push(e),e.initEditorFunctions(),EditorManager.onNoteDown(e,null,!0)}EditorManager.aPreviousSelection=EditorManager.aSelectedNotes.slice(),EditorManager.aCopyNotes=[],$("#copy-info").html("no notes copied")},deleteNotes:function(a){if("input"!=a.event.target.sourceElement){for(var b=0;b<EditorManager.aSelectedNotes.length;b++){var c=EditorManager.aSelectedNotes[b],d=EditorManager.aSelectedNotes[b].lane;if("undefined"!=typeof c.time){time=c.time;var e=EditorManager.aMsTapped[d].indexOf(time);ele=EditorManager.aMsTapped[d].splice(e,1)}c=HighwayManager.aNotes[d].splice(HighwayManager.aNotes[d].indexOf(c),1),c=c[0],c.kill(!0)}EditorManager.resetSelectedNotes()}},onNoteDragStart:function(a,b){a.originalLane=a.lane,a.rlDrag=!0,EditorManager.dragging=!0;for(var c=0;c<EditorManager.aSelectedNotes.length;c++)EditorManager.aSelectedNotes[c]&&!EditorManager.aSelectedNotes[c].input.isDragged&&EditorManager.aSelectedNotes[c].input.startDrag(game.input.activePointer)},onNoteDragStop:function(a,b){var c=HighwayManager.aNotes;EditorManager.dragging=!1,noteObject=c[a.originalLane].splice(c[a.originalLane].indexOf(a),1),noteObject=noteObject[0],lane=noteObject.setLaneForX(a.x)-1,noteIndex=c[noteObject.lane].push(noteObject)-1,a=noteObject,time=RL.getTimeForY(a.y),EditorManager.beatsInitialized&&EditorManager.grid_snap&&(snap=1e3*EditorManager.secondsPerNote,time=time.roundTo(snap)),a.time=time,a.y=RL.getYForTime(time),"undefined"!=typeof a.rect&&a.drawRect()},moveAllByMs:function(a){for(var b=1;b<HighwayManager.aNotes.length;b++){laneNotes=HighwayManager.aNotes[b];for(var c=0;c<laneNotes.length;c++)n=laneNotes[c],n.time=parseFloat(n.time)+parseFloat(a),n.y=RL.getYForTime(parseFloat(n.time)),n.drawRect(),EditorManager.notesChanged++}},save:function(){EditorManager.finish(null,!0,!0)},finish:function(a,b,c){"undefined"==typeof b&&(b=!1),"undefined"==typeof c&&(c=!1);var d=[],e=0;h=$.map(HighwayManager.aNotes,function(a,b){return[a]});for(var f=0;f<h.length;f++){aIndex=d.push([])-1,lane=h[f];for(var g=0;g<lane.length;g++)d[aIndex].push({time:lane[g].time,duration:lane[g].duration,hopo:lane[g].hopo}),length=d[aIndex].length-1;e+=d[aIndex].length}if(5>e)(!b||c)&&jQuery("#modal-errorMinimumNotes").foundation("reveal","open");else{var h=JSON.stringify(d);"2"==$('select[name="status"] option:selected').val()&&$('select[name="status"]').attr("disabled",!0),jQuery.post("/create/editor/"+song_slug+"/"+$('select[name="difficulty"]').val()+(track_id?"/"+track_id:""),{name:$("#track-name").val(),status:$('select[name="status"]').val(),difficulty:$('select[name="difficulty"]').val(),notes:h,lanes:$('select[name="lanes"]').val(),song_id:song_id,track_id:track_id,px_per_second:RL.config.pxPerSecond,auto_save:b,_token:csrf},function(a){"undefined"!=typeof a.error?(alert("An error occured! We didn't save the track. We added debug data to a box on the bottom of the page. Please copy and post it to a thread in the forums. We also disable autosave if itâ€™s currently active."),$("#error-debug textarea").html("Track ID: "+track_id+"\r\n"+h),$("#error-debug").fadeIn(),b&&EditorManager.toggleAutoSave()):(b?track_id||(document.location.hash=a.track_id,track_id=a.track_id):location.href="/create/review/"+song_slug+"/"+a.track_id,$(".stats-notecount").html(a.note_count),$('select[name="status"] option[value="'+a.status+'"]').attr("selected",!0))});var i=new Date,j=RL.str_pad(i.getHours(),2,"0","STR_PAD_LEFT")+":"+RL.str_pad(i.getMinutes(),2,"0","STR_PAD_LEFT")+":"+RL.str_pad(i.getSeconds(),2,"0","STR_PAD_LEFT");b&&!c?(jQuery("#auto-save-info").html("<b>Last Auto-Save:</b> "+j).show(),setTimeout(function(){jQuery("#auto-save-info").hide()},3e3)):c&&(jQuery("#manual-save-info").html("<b>Last Manual-Save:</b> "+j).show(),setTimeout(function(){jQuery("#manual-save-info").hide()},3e3))}},toggleTracking:function(){RL.config.trackTaps?RL.config.trackTaps=!1:RL.config.trackTaps=!0,document.getElementById("trackingCB").checked=RL.config.trackTaps?"checked":""},getNotesForTrack:function(){jQuery.post("/tools/getTrackById/"+track_id,{_token:csrf},function(a){HighwayManager.aNotes=a,HighwayManager.drawNotes()})},toggleAutoSave:function(a,b){"undefined"==typeof b&&(b=!1),b?(EditorManager.auto_save_js_interval=null,EditorManager.auto_save_js_interval=setInterval(function(){EditorManager.finish(null,!0)},1e3*EditorManager.auto_save_interval)):null!=EditorManager.auto_save_js_interval?(clearInterval(EditorManager.auto_save_js_interval),EditorManager.auto_save_js_interval=null,jQuery("#auto-save-container").fadeOut()):(EditorManager.auto_save_js_interval=setInterval(function(){EditorManager.finish(null,!0)},1e3*EditorManager.auto_save_interval),jQuery("#auto-save-container").fadeIn())},print:function(a){var b="";for(var c in a)b+="string"==typeof a[c]?c+": "+a[c]+";":c+": {"+EditorManager.print(a[c])+"}";return b}}},RL.HighwayManager=function(){return{aButtons:[!1],aLanes:[!1],emitter:[!1],progressBar:!1,secondsOnScreen:RL.config.height/RL.config.pxPerSecond,topSecondsDistance:RL.config.buttonY/RL.config.pxPerSecond,containerDragStart:0,containerDragEnd:0,animateNoteDistanceInterval:!1,drawNotes:function(){noteContainer.removeAll(!0);for(var a=1;a<=RL.config.lanes;a++){notes=this.aNotes[a]||[];for(var b=0;b<notes.length;b++)duration=notes[b].duration,"undefined"!=typeof notes[b].time?t=notes[b].time:"undefined"!=typeof notes[b].start?(t=1e3*notes[b].start,duration=1e3*notes[b].duration):t=notes[b].ms,null!==t?(notes[b]=new RL.Note(game,{time:t,lane:a,duration:duration,cb:"undefined"!=typeof notes[b].cb?notes[b].cb:!1,hitcb:"undefined"!=typeof notes[b].hitcb?notes[b].hitcb:!1,hopo:notes[b].hopo}),notes[b].exists=!0,noteContainer.add(notes[b]),RL.editMode&&notes[b].initEditorFunctions()):this.aNotes[a].splice(b,1)}this.drawHitArea()},updateNotes:function(a){a=$.map(a,function(a,b){return[a]});for(var b=1;b<a.length;b++){laneNotes=a[b];for(var c=0;c<laneNotes.length;c++)currNote=laneNotes[c].updateY()}},animateNoteDistance:function(a){HighwayManager.animateNoteDistanceInterval&&clearInterval(HighwayManager.animateNoteDistanceInterval),HighwayManager.animateNoteDistanceFrom=RL.config.pxPerSecond,RL.config.pxPerSecond=a,HighwayManager.updateNotes(HighwayManager.aNotes),RL.editMode&&($("#slider-pxPerSecond").slider("value",RL.config.pxPerSecond),$("span#pxPerSecond").html(RL.config.pxPerSecond))},countIn:function(a){RL.HighwayManager.counterOverlay=$(".counter-overlay"),RL.HighwayManager.counterOverlay.transition({opacity:.5}),RL.HighwayManager.counterOverlay.find(".info").hide(),RL.HighwayManager.counterOverlay.find(".count").show(),this.counter={start:(new Date).getTime(),count:RL.config.countSeconds},$(".counter-overlay .count").html(this.counter.count),this.counterInterval=setInterval(function(){HighwayManager.counter.count--,RL.sounds.drumstick.play(),HighwayManager.counter.count<=0?(RL.sounds.drumstick.stop(),$(".counter-overlay").hide(),clearInterval(HighwayManager.counterInterval),AudioManager.play()):$(".counter-overlay .count").html(HighwayManager.counter.count)},1e3)},drawGrid:function(){grid=game.add.image(0,0,"spritesheet",35),grid.alpha=.5},createButtons:function(){for(var a=1;5>=a;a++){var b=game.add.sprite(RL.getPosXForLane(a)-RL.config.buttonWidth/2,RL.config.buttonY,"spritesheet",5*a-5);a>RL.config.lanes&&(b.alpha=.25),this.aButtons.push(b),b.inputEnabled=!0,b.lane=a,b.z=5;var c=game.input.keyboard.addKey(RL.config.buttonKeys[a]);c.onDown.add(keyDownHandler,this),c.onUp.add(keyUpHandler,this),c.onHoldCallback=keyHoldHandler,InteractionManager.aKeyboardEvents.push(c)}if("strum"==RL.config.mode){var c=game.input.keyboard.addKey(RL.config.buttonKeys[6]);c.onDown.add(keyDownHandler,this),c.onUp.add(keyUpHandler,this),c.onHoldCallback=keyHoldHandler,InteractionManager.aKeyboardEvents.push(c)}game.input.keyboard.clearCaptures()},showLoadingScreen:function(){$(".large-player-loading-overlay").fadeOut(),$(".loading-overlay").show(),RL.loadingStep="-=360deg",RL.loadingAnimation=setInterval(function(){$(".loading-overlay img").css({transformOrigin:"11px 10px"}).transition({rotate:RL.loadingStep,duration:850}),RL.loadingStep="-=360deg"==RL.loadingStep?"+=360deg":"-=360deg"},1010)},hideLoadingScreen:function(){$(".loading-overlay").fadeOut(),clearInterval(RL.loadingAnimation)},showInfoScreen:function(){$(".counter-overlay").fadeIn()},hideInfoScreen:function(){$(".counter-overlay").fadeOut()},drawHitArea:function(){max=RL.config.buttonY+RL.config.noteHeight+10,min=RL.config.buttonY-2,grid=game.add.graphics(0,0),grid.lineStyle(RL.config.gridLineWidth,RL.config.laneColors[1]),grid.moveTo(0,max),grid.alpha=.5,grid.lineTo(RL.config.width,max),grid=game.add.graphics(0,0),grid.lineStyle(RL.config.gridLineWidth,RL.config.laneColors[1]),grid.moveTo(0,min),grid.alpha=.5,grid.lineTo(RL.config.width,min)},particleBurst:function(a){RL.config.showBurst&&this.emitter[a].start(!0,700,null,5)},startHitDetection:function(a){if("strum"==RL.config.mode)if(6===a){for(var b=0,c=1;5>=c;c++)RL.hittableNotes[c]&&RL.pressedButtons[c]?(InteractionManager.strumDuration[c]={start:(new Date).getTime(),duration:0},InteractionManager.keyboardPresses[c]=RL.hittableNotes[c],InteractionManager.keyboardPresses[c].burst(),ScoreManager.sustainedCache[c]=0,ScoreManager.notes_hit++,b++):RL.hittableNotes[c]&&(ScoreManager.reset(),b=-1);0>=b&&ScoreManager.reset()}else RL.pressedButtons[a]=!0;else"tap"==RL.config.mode&&(RL.hittableNotes[a]?(InteractionManager.keyboardPresses[a]=RL.hittableNotes[a],InteractionManager.keyboardPresses[a].burst(),ScoreManager.notes_hit++):ScoreManager.reset())},continueHitDetection:function(a,b){"strum"==RL.config.mode?6!=a&&0!=InteractionManager.keyboardPresses[a]&&(InteractionManager.keyboardPresses[a].alive?(b=(new Date).getTime()-InteractionManager.strumDuration[a].start,InteractionManager.keyboardPresses[a].burstLong(b,AudioManager.getPosition())):InteractionManager.keyboardPresses[a]=0):"tap"==RL.config.mode&&0!==InteractionManager.keyboardPresses[a]&&InteractionManager.keyboardPresses[a].burstLong(b,AudioManager.getPosition())},endHitDetection:function(a){"strum"==RL.config.mode?6===a||(RL.pressedButtons[a]=!1,0!==InteractionManager.keyboardPresses[a]&&InteractionManager.keyboardPresses[a].endTap(),InteractionManager.keyboardPresses[a]=0):"tap"==RL.config.mode&&(0!==InteractionManager.keyboardPresses[a]&&(InteractionManager.keyboardPresses[a].endTap(),InteractionManager.keyboardPresses[a]=0),ScoreManager.resetSustainedCache(a))}}},RL.InteractionManager.Editor=function(){return{init:function(){$("body").on("copy",function(a){EditorManager.copyNotes(a)}),$("body").on("paste",function(a){EditorManager.pasteNotes(a)}),$("#grid").on("change",function(){EditorManager.grid=parseFloat($(this).find("option:selected").val()),EditorManager.drawBeatLines(!0)}),$("#ticksCB").on("change",function(){EditorManager.playTicks=$("#ticksCB:checked").length>0?!0:!1}),$("#toggleLines").on("change",function(){$("#toggleLines:checked").length>0?EditorManager.advancedMode=!0:(EditorManager.advancedMode=!1,EditorManager.deleteBeatLines())}),$("#move_notes").on("click",function(a){a.preventDefault();var b=$('input[name="move_notes_ms"]').val();confirm("Are you sure you want to move all notes of this track by "+b+"ms?")&&(EditorManager.notesChanged=0,EditorManager.moveAllByMs(b))}),$("#sel-note-time").on("change",function(){for(var a=0;a<EditorManager.aSelectedNotes.length;a++)EditorManager.aSelectedNotes[a]&&(EditorManager.aSelectedNotes[a].time=parseFloat($(this).val()),EditorManager.aSelectedNotes[a].updateY())}),$("#sel-note-lane").on("change",function(){for(var a=0;a<EditorManager.aSelectedNotes.length;a++)EditorManager.aSelectedNotes[a]&&EditorManager.aSelectedNotes[a].updateLane($(this).val())}),$("#sel-note-duration").on("change",function(){for(var a=0;a<EditorManager.aSelectedNotes.length;a++)EditorManager.aSelectedNotes[a]&&EditorManager.aSelectedNotes[a].updateDuration($(this).val())}),$("#sel-note-distance").on("change",function(){var a=$(this).val();isNaN(a)?($(this).val("-"),EditorManager.aSelectedNotes[0].cb=""):EditorManager.aSelectedNotes[0].cb="HighwayManager.animateNoteDistance("+a+")"}),$("#sel-note-hopo").on("change",function(){for(var a=$("#sel-note-hopo:checked").length,b=0;b<EditorManager.aSelectedNotes.length;b++)EditorManager.aSelectedNotes[b]&&EditorManager.aSelectedNotes[b].setHOPO(a)}),$("#deselect-all").on("click",function(a){a.preventDefault(),EditorManager.resetSelectedNotes()}),$("#copy-selected a").on("click",function(a){a.preventDefault(),EditorManager.copyNotes(a)}),$("#paste-copied a").on("click",function(a){a.preventDefault(),EditorManager.pasteNotes(a)}),$("#previous-selection a").on("click",function(a){a.preventDefault(),EditorManager.activatePreviousSelection(a)}),jQuery("#autoSaveCB").on("change",EditorManager.toggleAutoSave),jQuery(".toggle-playback").on("click",InteractionManager.togglePlayback);var a=game.input.keyboard.addKey(RL.config.seekForwardKey);a.onHoldCallback=EditorInteractionManager.seekForward;var b=game.input.keyboard.addKey(RL.config.seekBackwardKey);b.onHoldCallback=EditorInteractionManager.seekBackward;var c=game.input.keyboard.addKey(RL.config.speedUpKey);c.onHoldCallback=EditorInteractionManager.speedUp;var d=game.input.keyboard.addKey(RL.config.speedDownKey);d.onHoldCallback=EditorInteractionManager.speedDown;var e=game.input.keyboard.addKey(RL.config.deleteKey);e.onDown.add(EditorManager.deleteNotes,this);var f=game.input.keyboard.addKey(RL.config.newLineKey);f.onDown.add(EditorManager.newLine,this),jQuery(".mute").on("click",EditorInteractionManager.toggleMute),jQuery("#btn-finish").on("click",EditorManager.finish),jQuery("#btn-save").on("click",EditorManager.save),jQuery('input[name="destroyNotes"]').on("change",function(){jQuery(this).is(":checked")?RL.config.destroyNotes=!0:RL.config.destroyNotes=!1}),EditorManager.autoSaveSlider=jQuery("#slider-autoSave").slider({value:EditorManager.auto_save_interval,range:"min",min:5,max:1800,step:5,slide:function(a,b){tval=b.value+" seconds",b.value>=60&&(tval=parseFloat(b.value/60).toFixed(1)+" minutes"),jQuery("#auto-save-interval").html(tval),EditorManager.auto_save_interval=b.value,EditorManager.toggleAutoSave(null,!0)}}),EditorManager.pxPerSecondSlider=jQuery("#slider-pxPerSecond").slider({value:RL.config.pxPerSecond,range:"min",min:30,max:1e3,step:1,slide:function(a,b){jQuery("#pxPerSecond").html(b.value),RL.config.pxPerSecond=b.value,RL.config.pxPerMs=RL.config.pxPerSecond/1e3,RL.negPxPerMs=-RL.config.pxPerMs,RL.msOnScreen=RL.config.height/RL.config.pxPerMs,EditorManager.advancedMode&&EditorManager.drawBeatLines(!0),HighwayManager.updateNotes(HighwayManager.aNotes)}}),setTimeout(function(){jQuery("#slider-position").html(""),EditorManager.positionSlider=jQuery("#slider-position").slider({value:0,range:"min",min:0,max:AudioManager.getDuration(),step:1,slide:function(a,b){AudioManager.setPosition(b.value)}})},500),EditorManager.playbackRateSlider=jQuery("#slider-playbackRate").slider({value:RL.config.playbackRate,range:"min",min:.5,max:4,step:.1,slide:function(a,b){jQuery("#playbackRate").html(b.value),RL.config.playbackRate=b.value,AudioManager.setPlaybackRate(b.value)}}),jQuery('input[name="tracking"]').on("click",function(){EditorManager.toggleTracking()}),jQuery('input[type="text"]').on("focus",function(){RL.config.trackTaps?(EditorManager.toggleTracking(),jQuery(this).data("trackTaps",!0)):jQuery(this).data("trackTaps",!1)}),jQuery('input[type="text"]').on("focusout",function(){jQuery(this).data("trackTaps")&&EditorManager.toggleTracking()})},seekForward:function(a,b){"undefined"==typeof b&&(b="undefined"!=typeof a.duration?a.duration/10:1),AudioManager.setPosition(AudioManager.getPosition()+b)},seekBackward:function(a,b){"undefined"==typeof b&&(b="undefined"!=typeof a.duration?a.duration/10:1),AudioManager.setPosition(AudioManager.getPosition()-b)},speedUp:function(a,b){"undefined"==typeof b&&(b=AudioManager.getPlaybackRate()+.005),b>4&&(b=4),AudioManager.setPlaybackRate(b),EditorManager.playbackRateSlider.slider("value",b),jQuery("#playbackRate").html(b.toFixed(2))},speedDown:function(a,b){"undefined"==typeof b&&(b=AudioManager.getPlaybackRate()-.005),.5>b&&(b=.5),AudioManager.setPlaybackRate(b),EditorManager.playbackRateSlider.slider("value",b),jQuery("#playbackRate").html(b.toFixed(2))},toggleMute:function(){"undefined"!=typeof AudioManager.muted&&(AudioManager.toggleMute(),AudioManager.muted?jQuery(".audio-controls .mute").removeClass("unmute"):jQuery(".audio-controls .mute").addClass("unmute"))},resetSpeed:function(a,b){AudioManager.setPlaybackRate(1)},handleCanvasUp:function(a){HighwayManager.containerDragStart=0},handleCanvasDown:function(a){0==a.button?HighwayManager.containerDragStart=a.positionDown.y:2==a.button&&(dist=(RL.config.buttonY-a.positionDown.y)/RL.config.pxPerSecond,time=AudioManager.getPosition()+dist+.1)}}},RL.ScoreManager=function(){return{score:0,multiplier:1,streak:0,max_streak:0,max_multiplier:0,notes_hit:0,notes_missed:0,percent:0,sustainedCache:[0,0,0,0,0,0],cheeringStreak:[25,50,100,150,200,300,400,500],singleNotePoints:50,$score:$(".score-display .score"),$streak:$(".score-display .streak"),$multiplier:$(".score-display .multiplier"),init:function(){this.$score.html("0"),this.$streak.html("0"),this.$multiplier.html("x1"),$(".repeat-song").unbind().on("click",function(a){a.preventDefault(),$(".score-overlay").fadeOut(),ScoreManager.animateFinishBack(".score-points-wrap",0),ScoreManager.animateFinishBack(".score-streak-wrap",1),ScoreManager.animateFinishBack(".score-multiplier-wrap",0),RL.init()}),$(".share-score").unbind().on("click",function(a){FB.ui({method:"feed",caption:"Can you beat my score?",name:share_title,description:"I just scored "+numberWithDots(ScoreManager.score)+' points on "'+song_name+'" by '+artist_name+"! A max streak of "+numberWithDots(ScoreManager.max_streak)+", "+numberWithDots(ScoreManager.notes_hit)+" notes hit and a completion of "+ScoreManager.percent+"%. #thisisrocklegend",link:share_url,picture:thumbnail_url})})},ended:function(){RL.editMode||testMode||$.post("/play/score/"+track_id+"/save",{score:ScoreManager.score,max_streak:ScoreManager.max_streak,max_multiplier:ScoreManager.max_multiplier,notes_missed:ScoreManager.notes_missed,notes_hit:ScoreManager.notes_hit},function(a){rl.focusMode&&rl.darkenPage(),$(".score-overlay").fadeIn();var b=notes_count,c=(ScoreManager.notes_hit/b*100).toFixed(2);ScoreManager.percent=c,ScoreManager.animateFinish(".score-points-wrap",2,function(){}),setTimeout(function(){ScoreManager.animateFinish(".score-streak-wrap",1.5,function(){$(".score-streak-wrap h1").eq(2).not(".streak").html("Max Streak"),$(".score-streak-wrap h1.streak").eq(1).html(ScoreManager.max_streak)})},270),setTimeout(function(){ScoreManager.animateFinish(".score-multiplier-wrap",3.5,function(){$(".score-multiplier-wrap h1").eq(2).not(".multiplier").html("Percent"),$(".score-multiplier-wrap h1.multiplier").eq(1).html(c+"%")})},540),setTimeout(function(){$(".score-button-wrap").fadeIn()},1010),RL.sounds.crowds[0].play()})},animateFinish:function(a,b,c){var b="undefined"!=typeof b?b:0,d=$(a),e=d.clone();e.css({position:"absolute",top:d.offset().top-1,left:d.offset().left}).appendTo("body").transition({left:$(".score-overlay").offset().left+$(".score-overlay").width()/2-e.width()+20*b,duration:500},500,"ease-in-out"),d.fadeOut(0).css({display:"inline-block",visibility:"hidden"}),c()},animateFinishBack:function(a,b){var c=$(a).eq(0),d=$(a).eq(1);d.transition({
left:c.offset().left-20*b,duration:500},500,"ease-in-out"),setTimeout(function(){d.fadeOut(200,function(){d.remove()}),c.css("visibility","visible").fadeOut(0).fadeIn(200)},500)},adjustScoreBox:function(){$(".scoreBox").css({position:"absolute",left:$("#main-canvas canvas").offset().left+RL.config.width,top:$("#main-canvas canvas").offset().top+60})},scoreSingleNote:function(){this.score+=this.singleNotePoints*this.multiplier,this.increaseStreak(),this.streak%10==0&&this.increaseMultiplier(),this.$score.html(numberWithDots(this.score))},scoreSustainedNote:function(a,b,c){perc=Math.ceil(b/(a/100)/1e3*a*this.multiplier),this.score-=this.sustainedCache[c],this.sustainedCache[c]<=0&&(this.increaseStreak(),this.streak%10==0&&this.increaseMultiplier()),this.sustainedCache[c]=perc,this.score+=perc,this.$score.html(numberWithDots(this.score))},resetSustainedCache:function(a){this.sustainedCache[a]=0},increaseMultiplier:function(){this.multiplier<=3&&(this.multiplier++,this.$multiplier.html("x"+this.multiplier),this.max_multiplier<this.multiplier&&(this.max_multiplier=this.multiplier))},increaseStreak:function(){this.streak++,this.$streak.html(this.streak),this.max_streak<this.streak&&(this.max_streak=this.streak),this.cheeringStreak.indexOf(this.streak)>-1&&(rand=Math.floor(Math.random()*RL.sounds.crowds.length),RL.sounds.crowds[rand].play())},reset:function(){this.multiplier=1,this.streak=0,this.$streak.html("0"),this.$multiplier.html("x1")}}},RL.States.Boot={soundsToLoad:1,soundsLoaded:0,preload:function(){HighwayManager.showLoadingScreen(),game.load.crossOrigin="anonymous",game.load.baseURL=ASSETS_BASE_URL,game.load.atlasJSONHash("spritesheet","/assets/images/game/spritesheet-player.png?t="+(new Date).getTime(),"/assets/images/game/spritesheet-hash.json?t="+(new Date).getTime()),game.load.audio("squeak",["/assets/sounds/game/squeak1.mp3","/assets/sounds/game/squeak1.ogg"]),game.load.audio("tick",["/assets/sounds/game/tick.mp3","/assets/sounds/game/tick.ogg"]),game.load.script("webfont","/assets/js/plugins/webfont.js"),createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin,createjs.WebAudioPlugin,createjs.FlashPlugin]),createjs.Sound.registerSound(game.load.baseURL+soundFiles[0],"music"),createjs.Sound.addEventListener("fileload",createjs.proxy(this.loadedSound,this))},update:function(){this.soundsToLoad<=this.soundsLoaded&&($("#main-canvas canvas").css("visibility","visible"),"undefined"==typeof RL.music?RL.music=createjs.Sound.createInstance("music"):AudioManager.stop(),RL.music.addEventListener("complete",createjs.proxy(ScoreManager.ended,this)),RL.sounds.squeaks=[game.add.sound("squeak1")],$(document).on("keydown",function(a){32!=a.which||$("input,textarea").is(":focus")||a.preventDefault()}),RL.sounds.ticks=[!1,game.add.sound("tick"),game.add.sound("tick"),game.add.sound("tick"),game.add.sound("tick"),game.add.sound("tick")],game.state.start("Editor"))},loadedSound:function(){this.soundsLoaded++}},RL.States.Editor={dragBoxNoteContainerStartY:0,dragStartX:!1,dragStartY:!1,dragBoxWidth:!1,dragBoxHeight:!1,$timer:$('#debug-container input[name="current-time"]'),preload:function(){},create:function(){game.stage.disableVisibilityChange=!0,game.stage.backgroundColor=2894892,InteractionManager.init(),HighwayManager.drawGrid(),HighwayManager.createButtons(),noteContainer=game.add.group(game,game.world,"noteContainer",!1),noteContainer.inputEnabled=!0,HighwayManager.drawNotes(),EditorManager.init(),game.input.onDown.add(EditorInteractionManager.handleCanvasDown),game.input.onUp.add(EditorInteractionManager.handleCanvasUp),squeak=game.add.sound("squeak"),tick=game.add.sound("tick"),_emitters=HighwayManager.emitter,_emitterY=RL.config.buttonY+RL.config.buttonHeight/2;for(var a=1;5>=a;++a)_emitters.push(game.add.emitter(0,0,50)),_emitters[a].makeParticles(["spritesheet"],24+a),_emitters[a].gravity=400,_emitters[a].x=RL.getPosXForLane(a),_emitters[a].y=_emitterY;AudioManager.init(),$("canvas").on("contextmenu",function(a){a.preventDefault()}),HighwayManager.hideLoadingScreen(),dragSelectionBox=game.add.graphics(0,0),dragSelectionBox.z=100,dragSelectionBox.renderable=!1,dragSelectionPhysicsBox=game.add.sprite(0,0,null),dragSelectionPhysicsBox.renderable=!1,game.physics.enable(dragSelectionPhysicsBox,Phaser.Physics.ARCADE),dragSelectionPhysicsBox.body.setSize(0,0,0,0)},update:function(){if(currentPlaybackTime=AudioManager.getPosition(),noteContainer.y=RL.config.buttonY+currentPlaybackTime/1e3*RL.config.pxPerSecond,game.time.now%2==0&&this.$timer.val(currentPlaybackTime.toFixed(3)),EditorManager.positionSlider&&EditorManager.positionSlider.slider("value",currentPlaybackTime.toFixed(3)),game.input.activePointer.isDown&&!EditorManager.dragging)game.input.activePointer.y<=25?AudioManager.setPosition(currentPlaybackTime+game.input.activePointer.duration/75):game.input.activePointer.y>=RL.config.height-25&&AudioManager.setPosition(currentPlaybackTime-game.input.activePointer.duration/75),EditorManager.dragging||(this.dragStartX===!1&&(this.dragStartX=game.input.activePointer.x,this.dragStartY=game.input.activePointer.y,this.dragBoxNoteContainerStartY=noteContainer.y),dragSelectionBox.endFill(),dragSelectionBox.clear(),dragSelectionBox.beginFill(13421772,.5),dragSelectionBox.lineStyle(1,16777215,.8),this.dragBoxWidth=game.input.activePointer.x-this.dragStartX,noteContainerDiff=noteContainer.y-this.dragBoxNoteContainerStartY,startY=this.dragStartY+noteContainerDiff,this.dragBoxHeight=game.input.activePointer.y-startY,dragSelectionBox.drawRect(this.dragStartX,startY,this.dragBoxWidth,this.dragBoxHeight));else if(this.dragStartX!==!1){if(dragSelectionBox.endFill(),(this.dragBoxWidth>40||this.dragBoxWidth<-40)&&(this.dragBoxHeight>20||this.dragBoxHeight<-20)){if(noteContainerDiff=noteContainer.y-this.dragBoxNoteContainerStartY,startY=this.dragStartY+noteContainerDiff,dragSelectionPhysicsBox.body.setSize(Math.abs(this.dragBoxWidth),Math.abs(this.dragBoxHeight),this.dragBoxWidth<0?this.dragStartX+this.dragBoxWidth:this.dragStartX,this.dragBoxHeight<0?startY+this.dragBoxHeight:startY),null!=game.input.keyboard.event)var a=game.input.keyboard.event.shiftKey;else a=!1;a||EditorManager.resetSelectedNotes(),setTimeout(function(){dragSelectionBox.clear(),noteContainer.forEach(function(a){game.physics.arcade.overlap(a,dragSelectionPhysicsBox,function(a,b){EditorManager.onNoteDown(a,null,!0)})})},50)}else dragSelectionBox.clear();this.dragStartX=!1,this.dragStartY=!1}EditorManager.advancedMode&&(EditorManager.beatLineContainer.y=noteContainer.y,EditorManager.beatLineTextContainer.y=noteContainer.y,EditorManager.drawBeatLines())},render:function(){}},RL.Note=function(a,b){if(this.className="RL.Note",this.game=a,"undefined"==typeof b.y||null==b.y)var c=RL.getYForTime(b.time);else var c=b.y;var d=RL.getXForLaneButton(b.lane),e=b.lane,f=b.time,g=b.duration,h=(b.hopo?2:0,"undefined"!=typeof b.cb?b.cb:!1),i="undefined"!=typeof b.hitcb?b.hitcb:!1;Phaser.Sprite.call(this,this.game,d,c,"spritesheet",0),this.showRect="undefined"!=typeof b.showRect?b.showRect:!1,this.hopo="undefined"!=typeof b.hopo?b.hopo:!1,this.hit=!1,this.lane=e,this.time=parseFloat(f),this.removed=!1,this.originalTime=parseFloat(f),this.duration="undefined"!=typeof g?parseFloat(g):0,this.originalDuration=parseFloat(this.duration),this.endTime=this.time+this.duration,this.cb_fired=!1,this.hitcb_fired=!1,this.cb=h,this.hitcb=i,this.maxHitY=RL.config.buttonY+RL.config.buttonHeight,this.minHitY=RL.config.buttonY-RL.config.noteHeight/1.5,this.shortMaxHitY=this.maxHitY,this.duration>=RL.config.longNoteThreshold&&this.drawRect(this.showRect),this.exists=!1,this.setDefaultTexture(),this.game.add.existing(this)},RL.Note.prototype=Object.create(Phaser.Sprite.prototype),RL.Note.prototype.constructor=RL.Note,RL.Note.prototype.create=function(){},RL.Note.prototype.drawRect=function(a){"undefined"==typeof a&&(a=!1);var b=this.duration/1e3*RL.config.pxPerSecond+RL.config.noteHeight/2;if(rectangleY=this.y-b+RL.config.noteHeight/2,"undefined"==typeof this.rect){var c=game.add.image(RL.getPosXForLane(this.lane)-11,rectangleY,"spritesheet",29+this.lane);c.scale.setTo(1,b/30),a===!1&&(c.exists=!1,c.alpha=.5),noteContainer.add(c),noteContainer.sendToBack(c),this.rect=c}else this.rect.y!==rectangleY&&(this.rect.scale.setTo(1,1),this.rect.y=rectangleY,this.rect.scale.setTo(1,b/30)),a&&(this.rect.alpha=1,this.rect.scale.setTo(1,b/30));this.rectHeight=b,this.maxHitY=RL.config.buttonY+RL.config.noteHeight+10+b,this.killMaxY=this.maxHitY+50},RL.Note.prototype.update=function(){if(this.time>AudioManager.currentTime+RL.msOnScreen||this.time<AudioManager.currentTime-this.duration-250||!this.alive?(this.exists=!1,"undefined"!=typeof this.rect&&(this.rect.exists=!1)):(this.exists=!0,"undefined"!=typeof this.rect&&(this.rect.exists=!0)),null!=this.input&&this.input.isDragged){game.input.activePointer.y;this.input.updateDrag(game.input.activePointer),lane=this.setLaneForX(this.x)-1,time=RL.getTimeForY(this.y),EditorManager.beatsInitialized&&EditorManager.grid_snap&&(snap=1e3*EditorManager.secondsPerNote,time=time.roundTo(snap)),this.isSelected=!0,this.setDefaultTexture(),this.time=time,this.y=RL.getYForTime(time),"undefined"!=typeof this.rect&&(this.rect.destroy(),this.rect=void 0,this.drawRect(!0))}},RL.Note.prototype.kill=function(a){a="undefined"!=typeof a?a:!1,RL.hittableNotes[this.lane]=!1,a&&a&&"undefined"!=typeof this.rect&&this.rect.destroy(!0),noteContainer.remove(this,!0,!0)},RL.Note.prototype.updateY=function(){this.y=RL.getYForTime(this.time),"undefined"!=typeof this.rect&&this.drawRect()},RL.Note.prototype.updateTime=function(){var a=RL.getTimeForY(this.y);return this.time=a,a},RL.Note.prototype.updateDuration=function(a){this.duration=parseFloat(a),this.originalDuration=this.duration,this.endTime=this.time+this.duration,this.maxHitY=RL.config.buttonY+RL.config.noteHeight,this.minHitY=RL.config.buttonY-RL.config.noteHeight+20,this.shortMaxHitY=this.maxHitY,this.duration>=RL.config.longNoteThreshold?this.drawRect():"undefined"!=typeof this.rect&&this.rect.destroy()},RL.Note.prototype.setLaneForX=function(a,b){"undefined"==typeof b&&(b=!1);for(var c=0;c<=RL.config.lanes;++c){var d=RL.config.width/RL.config.lanes*c-RL.config.buttonWidth/2;if(b){var d=d+RL.config.noteWidth;if(d>=a)return this.lane=c,c}else if(d>=a)return this.lane=c,c}return this.lane=5,6},RL.Note.prototype.updateLane=function(a){for(var b=0;b<HighwayManager.aNotes.length;b++){laneNotes=HighwayManager.aNotes[b];for(var c=0;c<laneNotes.length;c++)laneNotes[c]==this&&laneNotes.splice(c,1)}return this.x=RL.getXForLaneButton(a),this.lane=a,this.loadTexture("spritesheet",5*this.lane-3),"undefined"!=typeof this.rect&&this.drawRect(),HighwayManager.aNotes[this.lane].push(this),this},RL.Note.prototype.setHOPO=function(a){this.hopo=a?!0:!1,this.setDefaultTexture()},RL.Note.prototype.setDefaultTexture=function(){this.isSelected?this.loadTexture("spritesheet",5*this.lane-2):this.hopo?this.loadTexture("spritesheet",5*this.lane-1):this.loadTexture("spritesheet",5*this.lane-3)},RL.Note.prototype.initEditorFunctions=function(){this.isSelected=!1,this.ticked=!1,this.inputEnabled=!0,this.input.enabled=!0,this.input.enableDrag(!1,!0,!0,255,0,new Phaser.Rectangle(RL.config.noteWidth/2,-900719925474,RL.config.width-RL.config.noteWidth,900719925474)),this.input.useHandCursor=!0,this.input.allowHorizontalDrag=!0,this.input.enableSnap(RL.config.width/(RL.config.lanes+1),.1,!0,!1,-RL.config.noteHeight/2,0),this.input.pixelPerfectAlpha=1,game.physics.enable(this,Phaser.Physics.ARCADE),this.events.onInputDown.add(EditorManager.onNoteDown),this.events.onInputUp.add(EditorManager.onNoteUp),this.events.onDragStart.add(EditorManager.onNoteDragStart),this.events.onDragStop.add(EditorManager.onNoteDragStop),this.onHold=EditorManager.onDragging};var game=null;jQuery(function(a){RL.init()}),Number.prototype.roundTo=function(a){var b=this%a;return a/2>=b?this-b:this+a-b};var waitForFinalEvent=function(){var a={};return function(b,c,d){d||(d="Don't call this twice without a uniqueId"),a[d]&&clearTimeout(a[d]),a[d]=setTimeout(b,c)}}();